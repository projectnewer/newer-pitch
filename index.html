<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newer | The New Construction Marketplace</title>
    
    <!-- Brand Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100' fill='none'><path d='M20 80 V35 L50 20 L50 55 L20 80 Z' fill='%230D9488' stroke='%230D9488' stroke-width='4' stroke-linejoin='round' /><path d='M80 20 V65 L50 80 L50 45 L80 20 Z' fill='%230D9488' stroke='%230D9488' stroke-width='4' stroke-linejoin='round' /></svg>">
    
    <!-- SEO Meta -->
    <meta name="description" content="Newer is the New Construction Marketplace. Stop chasing listings. Create a free profile and make top builders bid on your new home project. Access off-market and spec homes.">
    <meta name="keywords" content="New Homes, New Construction, Custom Builders, Off-Market Real Estate, Home Builder Bids, Spec Homes, Quick Move-In Homes">
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "RealEstateAgent",
      "name": "Newer",
      "description": "The first new construction marketplace where builders bid on verified buyers.",
      "url": "https://newer.com",
      "areaServed": ["Austin, TX", "Dallas, TX", "Houston, TX"],
      "knowsAbout": ["New Construction", "Spec Homes", "Custom Builds"]
    }
    </script>
    
    <!-- Font: Outfit (Brand) + JetBrains Mono (Data) -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Icons: Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- CSS (Tailwind JIT) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Outfit', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            teal: '#0D9488',     // Persian Green (Trust)
                            charcoal: '#0F172A', // Dark Slate (Anchor)
                            concrete: '#FAFAF9', // Stone 50 (Warmth)
                            gold: '#D97706',     // Amber 600 (Bronze/Premium)
                            border: '#E7E5E4',   // Warm Stone Gray
                            muted: '#78716C',    // Warm Muted Text
                            success: '#10B981',
                            danger: '#EF4444'
                        }
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                        'glow': '0 0 20px rgba(13, 148, 136, 0.4)', // Updated Teal RGB
                        'glow-gold': '0 0 30px rgba(217, 119, 6, 0.3)', // Updated Amber RGB
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'marquee': 'marquee 40s linear infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'stamp': 'stamp-in 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) both',
                        'fade-in': 'fade-in 0.5s ease-out forwards',
                        'typing': 'typing 1.5s infinite ease-in-out',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        marquee: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-50%)' }, 
                        },
                        'stamp-in': {
                            '0%': { opacity: '0', transform: 'scale(3) rotate(-10deg)' },
                            '100%': { opacity: '1', transform: 'scale(1) rotate(-10deg)' },
                        },
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        typing: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-3px)' }
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        body { font-family: 'Outfit', sans-serif; }

        /* Nhouse Pattern */
        .bg-house-pattern {
            background-image: 
                linear-gradient(45deg, rgba(0,0,0,0.03) 25%, transparent 25%), 
                linear-gradient(-45deg, rgba(0,0,0,0.03) 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, rgba(0,0,0,0.03) 75%), 
                linear-gradient(-45deg, transparent 75%, rgba(0,0,0,0.03) 75%);
            background-size: 20px 20px;
        }
        .dark .bg-house-pattern {
             background-image: 
                linear-gradient(45deg, rgba(255,255,255,0.03) 25%, transparent 25%), 
                linear-gradient(-45deg, rgba(255,255,255,0.03) 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, rgba(255,255,255,0.03) 75%), 
                linear-gradient(-45deg, transparent 75%, rgba(255,255,255,0.03) 75%);
        }

        /* Smooth Reveal Animation Class */
        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Ambient Glow Background */
        .ambient-glow {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80vw;
            height: 80vw;
            background: radial-gradient(circle, rgba(13,148,136,0.08) 0%, rgba(255,255,255,0) 70%);
            z-index: -1;
            pointer-events: none;
            transition: background 1s ease;
        }
        .dark .ambient-glow {
            background: radial-gradient(circle, rgba(217,119,6,0.06) 0%, rgba(15,23,42,0) 70%);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #FAFAF9; }
        ::-webkit-scrollbar-thumb { background: #D6D3D1; border-radius: 4px; }
        .dark ::-webkit-scrollbar-track { background: #0F172A; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        /* Floating UI Bubbles */
        .floating-bubble {
            animation: float-bubble 4s ease-in-out infinite;
            backdrop-filter: blur(8px);
        }
        @keyframes float-bubble {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        /* Toggle Slider Logic */
        .toggle-track { position: relative; }
        .toggle-pill {
            position: absolute;
            top: 0.25rem;
            bottom: 0.25rem;
            left: 0.25rem;
            width: calc(50% - 0.25rem);
            border-radius: 9999px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 0;
        }

        /* Input Range Styling */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: #0D9488; cursor: pointer; margin-top: -8px; 
            border: 3px solid #FFFFFF; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #E7E5E4; border-radius: 2px; }

        /* Stamp Effect */
        .stamp-container {
            border: 3px solid; 
            padding: 4px 12px;
            text-transform: uppercase;
            font-weight: 800;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
            transform: rotate(-10deg);
            display: inline-block;
            white-space: nowrap;
            z-index: 10;
        }
        
        /* Receipt Styles */
        .receipt-edge {
            background-image: radial-gradient(circle at 10px 0, transparent 6px, white 7px);
            background-size: 20px 10px;
            background-repeat: repeat-x;
            height: 10px;
            width: 100%;
            transform: rotate(180deg);
        }
        .dark .receipt-edge {
            background-image: radial-gradient(circle at 10px 0, transparent 6px, #1F2937 7px);
        }

        /* Chat Engine Styles */
        .chat-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 16px;
            font-size: 0.9rem;
            line-height: 1.5;
            position: relative;
            animation: fade-in 0.3s ease-out forwards;
        }
        .chat-bubble.ai {
            background-color: #FAFAF9; /* Concrete */
            color: #0F172A; /* Charcoal */
            border-bottom-left-radius: 4px;
            border: 1px solid #E7E5E4;
        }
        .dark .chat-bubble.ai {
            background-color: #1F2937;
            color: #F3F4F6;
            border-color: #374151;
        }
        .chat-bubble.user {
            background-color: #0D9488; /* Teal Default */
            color: white;
            border-bottom-right-radius: 4px;
            margin-left: auto;
        }
        .dark .chat-bubble.user {
            background-color: #D97706; /* Gold/Bronze for Builder */
            color: white;
        }
        .typing-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #9CA3AF;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    </style>
</head>
<body class="bg-brand-concrete text-brand-charcoal dark:bg-brand-charcoal dark:text-gray-100 font-sans antialiased pb-32 lg:pb-0 transition-colors duration-500 relative">

    <!-- Ambient Background -->
    <div class="ambient-glow"></div>

    <!-- Navbar -->
    <nav class="sticky top-0 z-50 bg-white/90 dark:bg-brand-charcoal/90 border-b border-brand-border dark:border-gray-800 backdrop-blur-md transition-colors duration-500">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <!-- LOGO LOCKUP -->
                <a href="#" class="flex items-center gap-2 group text-2xl" onclick="setAudience('buyer'); window.scrollTo({top: 0, behavior: 'smooth'});">
                    <div class="h-[1.15em] w-[1.15em] flex items-center justify-center">
                        <svg class="h-full w-full block transition-transform group-hover:scale-110 duration-300 ease-out" viewBox="0 0 100 100" fill="none">
                            <path id="nav-logo-path-1" d="M20 80 V35 L50 20 L50 55 L20 80 Z" fill="#0D9488" stroke="#0D9488" stroke-width="6" stroke-linejoin="round" class="theme-transition"/>
                            <path id="nav-logo-path-2" d="M80 20 V65 L50 80 L50 45 L80 20 Z" fill="#0D9488" stroke="#0D9488" stroke-width="6" stroke-linejoin="round" class="theme-transition"/>
                        </svg>
                    </div>
                    <span class="font-extrabold tracking-tight leading-none text-brand-charcoal dark:text-white transition-colors">Newer</span>
                </a>
                
                <!-- Desktop Animated Toggle -->
                <div class="hidden md:flex bg-gray-100 dark:bg-gray-800 rounded-full p-1 relative toggle-track w-[280px]">
                    <!-- The Sliding Pill -->
                    <div id="nav-toggle-pill" class="toggle-pill bg-white dark:bg-brand-charcoal shadow-sm border border-gray-200 dark:border-gray-600"></div>
                    
                    <button onclick="setAudience('buyer')" class="relative z-10 w-1/2 py-2 rounded-full text-sm font-bold transition-colors text-center" id="nav-btn-buyer">For Buyers</button>
                    <button onclick="setAudience('builder')" class="relative z-10 w-1/2 py-2 rounded-full text-sm font-bold transition-colors text-center text-gray-500" id="nav-btn-builder">For Builders</button>
                </div>

                <button id="nav-cta-btn" onclick="openWaitlistModal()" class="hidden md:block bg-brand-charcoal text-white px-6 py-2.5 rounded-full text-sm font-bold hover:bg-brand-teal dark:bg-brand-gold dark:text-brand-charcoal dark:hover:bg-white transition-all shadow-lg hover:shadow-glow transform hover:-translate-y-0.5">
                    Start Receiving Bids
                </button>
            </div>
        </div>
    </nav>

    <!-- Ticker -->
    <div class="w-full bg-brand-charcoal dark:bg-black text-gray-400 overflow-hidden z-40 relative h-10 flex items-center border-b border-brand-charcoal dark:border-gray-800 transition-colors">
        <div class="flex whitespace-nowrap overflow-hidden absolute w-full">
            <div class="animate-marquee inline-block text-xs font-bold tracking-wide">
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">New Permit</strong> issued in 78704</span>
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">3 Builders</strong> bidding on Lot 4</span>
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">Rate Buy-down</strong> secured by Buyer #221</span>
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">$15k Incentive</strong> accepted by Buyer #8492</span>
                <!-- Duplicates for seamless loop -->
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">New Permit</strong> issued in 78704</span>
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">3 Builders</strong> bidding on Lot 4</span>
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">Rate Buy-down</strong> secured by Buyer #221</span>
                <span class="mx-8"><span class="text-brand-teal dark:text-brand-gold">●</span> <strong class="text-white">$15k Incentive</strong> accepted by Buyer #8492</span>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="relative pt-12 pb-20 md:pt-24 md:pb-32 overflow-hidden bg-transparent theme-transition scroll-mt-28" id="hero">
        <!-- Decoration -->
        <div class="absolute top-0 right-0 w-1/2 h-full bg-gradient-to-l from-brand-concrete to-transparent dark:from-gray-900/50 hidden lg:block -z-10"></div>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10 w-full grid lg:grid-cols-2 gap-12 items-center">
            <div class="max-w-2xl reveal-on-scroll">
                <div id="hero-badge" class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-brand-teal/10 dark:bg-brand-gold/10 text-brand-teal dark:text-brand-gold text-xs font-bold uppercase tracking-widest mb-8 theme-transition border border-brand-teal/20 dark:border-brand-gold/20">
                    <span class="w-2 h-2 rounded-full bg-brand-teal dark:bg-brand-gold animate-pulse theme-transition" id="hero-badge-dot"></span> <span id="hero-badge-text">New Construction Marketplace</span>
                </div>
                <h1 id="hero-title" class="text-5xl md:text-7xl font-extrabold text-brand-charcoal dark:text-white tracking-tight mb-6 leading-[1.1] transition-colors">
                    Skip the Search for <span class="text-brand-teal">New Homes.</span><br>
                    Make Builders Bid.
                </h1>
                <p id="hero-desc" class="mt-6 text-lg md:text-xl text-brand-muted dark:text-gray-300 font-medium leading-relaxed transition-colors">
                    The first marketplace where you define the terms, and top builders compete to build your new construction home.
                </p>
                <!-- Geographic Context -->
                <div class="mt-4 flex items-center gap-2 text-xs font-bold text-brand-muted uppercase tracking-wide">
                    <i data-lucide="globe" class="w-4 h-4"></i> Live In: Austin • Dallas • Houston
                </div>

                <div class="mt-10 flex flex-col sm:flex-row gap-4 items-center">
                    <button onclick="openWaitlistModal()" id="hero-cta-main" class="w-full sm:w-auto px-8 py-4 bg-brand-teal text-white rounded-full font-bold shadow-lg hover:shadow-glow hover:-translate-y-1 transition-all text-center theme-transition">
                        Start Receiving Bids
                    </button>
                    <a href="#concept" class="w-full sm:w-auto px-8 py-4 bg-white dark:bg-transparent text-brand-charcoal dark:text-white border-2 border-brand-charcoal dark:border-white rounded-full font-bold hover:bg-brand-charcoal hover:text-white dark:hover:bg-white dark:hover:text-brand-charcoal transition-all text-center">How It Works</a>
                </div>
                <div class="mt-3 flex items-center gap-1.5 justify-center sm:justify-start text-[10px] text-gray-500 dark:text-gray-400">
                     <i data-lucide="shield-check" class="w-3 h-3 text-brand-teal"></i> Verified by Plaid
                </div>
            </div>
            
            <!-- Hero Graphic with Floating UI -->
            <div class="relative lg:h-[600px] w-full hidden md:block reveal-on-scroll" style="transition-delay: 200ms;">
                <div class="absolute inset-0 bg-house-pattern rounded-3xl transform rotate-3 border border-brand-border dark:border-gray-700 transition-colors opacity-50"></div>
                <div class="absolute inset-4 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden border border-brand-border dark:border-gray-700 transform -rotate-2 hover:rotate-0 transition-all duration-700 ease-out group relative">
                    <img id="hero-image-el" src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1200&q=80" 
                         alt="Newer app interface" 
                         class="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 group-hover:scale-105">
                    
                    <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>

                    <!-- Floating Notification Cards (Dynamic) -->
                    <div id="hero-floating-notifications" class="absolute inset-0 pointer-events-none p-8 flex flex-col justify-end items-end gap-4">
                        <!-- JS injects bubbles here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Trusted By -->
    <section class="py-12 bg-white/50 dark:bg-brand-charcoal/50 border-y border-brand-border dark:border-gray-800 transition-colors scroll-mt-28 reveal-on-scroll">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p id="trusted-label" class="text-xs uppercase tracking-widest text-brand-muted font-bold mb-8">Designed for Top Builders</p>
            <div class="flex flex-wrap justify-center items-center gap-12 md:gap-20 opacity-40 grayscale hover:grayscale-0 transition-all duration-500">
                <div class="font-extrabold text-2xl text-brand-charcoal dark:text-gray-400">LENNAR</div>
                <div class="font-extrabold text-2xl text-brand-charcoal dark:text-gray-400">TOLL BROTHERS</div>
                <div class="font-extrabold text-2xl text-brand-charcoal dark:text-gray-400">PULTE</div>
                <div class="font-extrabold text-2xl text-brand-charcoal dark:text-gray-400 flex items-center gap-2"><i data-lucide="landmark" class="w-6 h-6"></i> PLAID</div>
            </div>
        </div>
    </section>

    <!-- Concept Section -->
    <section id="concept" class="py-24 bg-brand-concrete/50 dark:bg-gray-900/50 transition-colors scroll-mt-28">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16 reveal-on-scroll">
                <h2 id="concept-title" class="text-3xl md:text-4xl font-extrabold text-brand-charcoal dark:text-white transition-colors">The Power Shift</h2>
                <p id="concept-desc" class="mt-4 text-brand-muted dark:text-gray-300 max-w-2xl mx-auto text-lg transition-colors">
                    We flipped the model. <span class="text-brand-teal font-bold" id="concept-highlight">Stop begging. Become the Client.</span>
                </p>
                <!-- AEO Definition Block -->
                <div class="mt-8 p-4 bg-white dark:bg-gray-800 rounded-lg border border-brand-border dark:border-gray-700 max-w-2xl mx-auto text-left shadow-sm">
                    <p class="text-sm italic text-gray-500 dark:text-gray-400" id="aeo-def-text">
                        <span class="font-bold text-brand-teal">Newer</span> is a new construction marketplace where top builders bid on verified buyers, reversing the traditional search process for new homes.
                    </p>
                </div>
            </div>
            <div class="grid md:grid-cols-2 gap-8 items-stretch">
                <!-- Old Way -->
                <div class="p-10 rounded-3xl bg-white dark:bg-gray-800 border border-brand-border dark:border-gray-700 relative h-full flex flex-col hover:shadow-lg transition-all reveal-on-scroll" style="transition-delay: 100ms;">
                    <span class="absolute top-8 right-8 text-xs font-bold text-gray-300 dark:text-gray-500 uppercase tracking-widest" id="concept-label-old">The Old Way</span>
                    <h3 id="concept-header-old" class="text-2xl font-bold text-brand-charcoal dark:text-white mb-6 flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-400 dark:text-gray-300"><i data-lucide="search" class="w-5 h-5"></i></div>
                        Active Shopper
                    </h3>
                    <ul id="concept-old-list" class="space-y-6 text-brand-muted dark:text-gray-400 font-medium flex-grow">
                         <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400"></i> Refreshing apps every 15 mins.</li>
                         <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400"></i> Driving to sold open houses.</li>
                         <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400"></i> Bidding wars.</li>
                    </ul>
                </div>
                <!-- New Way -->
                <div class="p-10 rounded-3xl bg-brand-charcoal dark:bg-black text-white relative h-full flex flex-col shadow-2xl transform md:-translate-y-4 border border-transparent dark:border-gray-800 reveal-on-scroll" style="transition-delay: 200ms;">
                    <span class="absolute top-8 right-8 text-xs font-bold text-brand-teal uppercase tracking-widest theme-transition" id="concept-badge-new">Newer Model</span>
                    <h3 id="concept-header-new" class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-brand-teal flex items-center justify-center text-white theme-transition" id="concept-icon-new"><i data-lucide="crown" class="w-5 h-5"></i></div>
                        VIP Client
                    </h3>
                    <ul id="concept-new-list" class="space-y-6 text-brand-muted font-medium flex-grow">
                        <!-- JS Filled -->
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- 1-2-3 How it Works (The Journey) -->
    <section id="how-it-works" class="py-20 bg-brand-concrete/30 dark:bg-gray-900/30 transition-colors overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center reveal-on-scroll relative">
            <h2 id="journey-title" class="text-3xl font-extrabold text-brand-charcoal dark:text-white mb-16">The Journey to Your New Construction Home</h2>
            
            <div class="relative grid md:grid-cols-3 gap-12">
                <!-- Connecting Line (Desktop) -->
                <div class="hidden md:block absolute top-12 left-[16%] right-[16%] h-0.5 bg-gray-200 dark:bg-gray-700 -z-10"></div>
                
                <!-- Step 1 -->
                <div class="step-card group relative flex flex-col items-center">
                    <div class="w-24 h-24 rounded-full bg-white dark:bg-gray-800 border-4 transition-colors duration-500 flex items-center justify-center mb-6 shadow-soft group-hover:scale-110 group-hover:shadow-glow transform duration-300 z-10 relative step-icon-container">
                        <div class="absolute -top-2 -right-2 bg-brand-charcoal dark:bg-white text-white dark:text-brand-charcoal text-[10px] font-bold px-2 py-1 rounded-full border-2 border-white dark:border-gray-800">01</div>
                        <i data-lucide="sliders-horizontal" class="w-10 h-10 step-icon transition-colors duration-300"></i>
                    </div>
                    <h3 class="font-bold text-xl text-brand-charcoal dark:text-white mb-2 transition-colors" id="step-1-title">Define</h3>
                    <p class="text-sm text-brand-muted dark:text-gray-400 max-w-xs mx-auto leading-relaxed" id="step-1-desc">Set your style, budget, and must-haves. Spec, Custom, or QMI.</p>
                </div>

                <!-- Step 2 -->
                <div class="step-card group relative flex flex-col items-center">
                    <div class="w-24 h-24 rounded-full bg-white dark:bg-gray-800 border-4 transition-colors duration-500 flex items-center justify-center mb-6 shadow-soft group-hover:scale-110 group-hover:shadow-glow transform duration-300 z-10 relative step-icon-container">
                        <div class="absolute -top-2 -right-2 bg-brand-charcoal dark:bg-white text-white dark:text-brand-charcoal text-[10px] font-bold px-2 py-1 rounded-full border-2 border-white dark:border-gray-800">02</div>
                        <i data-lucide="shield-check" class="w-10 h-10 step-icon transition-colors duration-300"></i>
                    </div>
                    <h3 class="font-bold text-xl text-brand-charcoal dark:text-white mb-2 transition-colors" id="step-2-title">Verify</h3>
                    <p class="text-sm text-brand-muted dark:text-gray-400 max-w-xs mx-auto leading-relaxed" id="step-2-desc">Prove you are real to unlock VIP status.</p>
                </div>

                <!-- Step 3 -->
                <div class="step-card group relative flex flex-col items-center">
                    <div class="w-24 h-24 rounded-full bg-white dark:bg-gray-800 border-4 transition-colors duration-500 flex items-center justify-center mb-6 shadow-soft group-hover:scale-110 group-hover:shadow-glow transform duration-300 z-10 relative step-icon-container">
                        <div class="absolute -top-2 -right-2 bg-brand-charcoal dark:bg-white text-white dark:text-brand-charcoal text-[10px] font-bold px-2 py-1 rounded-full border-2 border-white dark:border-gray-800">03</div>
                        <i data-lucide="inbox" class="w-10 h-10 step-icon transition-colors duration-300"></i>
                    </div>
                    <h3 class="font-bold text-xl text-brand-charcoal dark:text-white mb-2 transition-colors" id="step-3-title">Receive</h3>
                    <p class="text-sm text-brand-muted dark:text-gray-400 max-w-xs mx-auto leading-relaxed" id="step-3-desc">Builders compete for your new home business.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Interactive Demo Section -->
    <section id="demo" class="py-24 bg-white/50 dark:bg-brand-charcoal/50 relative overflow-hidden transition-colors scroll-mt-28" aria-labelledby="demo-title">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="mb-16 text-center reveal-on-scroll">
                <h2 id="demo-title" class="text-3xl md:text-4xl font-extrabold text-brand-charcoal dark:text-white transition-colors">Your Personal Market</h2>
                <p id="demo-desc" class="mt-4 text-brand-muted dark:text-gray-300 max-w-2xl mx-auto text-lg transition-colors">Broadcast your needs via the App. Watch the market respond.</p>
            </div>

            <div class="grid lg:grid-cols-12 gap-12 reveal-on-scroll">
                <!-- LEFT: Buyer App -->
                <div class="lg:col-span-4 flex flex-col items-center">
                    <div id="phone-container" class="w-full max-w-[350px] bg-white md:rounded-[3rem] md:border-8 md:border-brand-charcoal border-0 shadow-2xl overflow-hidden h-[700px] relative">
                        <div class="hidden md:block absolute top-0 left-1/2 transform -translate-x-1/2 w-32 h-6 bg-brand-charcoal rounded-b-2xl z-20"></div>
                        <!-- App Header -->
                        <div class="h-20 bg-white border-b border-brand-border flex items-end justify-between px-6 pb-3 pt-8">
                            <div class="h-8 w-8 flex items-end justify-center">
                                <svg class="h-full w-auto block" viewBox="0 0 100 100" fill="none">
                                    <path id="app-logo-path-1" d="M20 80 V35 L50 20 L50 55 L20 80 Z" fill="#0D9488" stroke="#0D9488" stroke-width="6" stroke-linejoin="round"/>
                                    <path id="app-logo-path-2" d="M80 20 V65 L50 80 L50 45 L80 20 Z" fill="#0D9488" stroke="#0D9488" stroke-width="6" stroke-linejoin="round"/>
                                </svg>
                            </div>
                            <div class="w-8 h-8 rounded-full bg-brand-concrete flex items-center justify-center"><i data-lucide="user" class="w-4 h-4 text-brand-charcoal"></i></div>
                        </div>
                        <!-- App Body -->
                        <div id="buyer-screen-container" class="h-[calc(100%-80px-60px)] overflow-y-auto bg-brand-concrete p-5 relative scrollbar-hide text-brand-charcoal">
                            <!-- STEP 1: Style -->
                            <div id="step-1" class="step-content fade-in">
                                <h3 class="text-xl font-bold text-brand-charcoal mb-1">Set the mood.</h3>
                                <p class="text-xs text-gray-400 mb-6 font-bold uppercase tracking-wide">Which style feels like home?</p>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="selectStyle('Modern')" class="style-btn group p-4 bg-white rounded-2xl shadow-sm hover:shadow-md transition-all text-center border border-transparent hover:border-brand-teal">
                                        <div class="h-12 w-12 mx-auto bg-brand-concrete rounded-full mb-3 flex items-center justify-center group-hover:bg-brand-teal group-hover:text-white transition-colors"><i data-lucide="box" class="w-5 h-5"></i></div>
                                        <span class="text-xs font-bold text-brand-charcoal">Modern</span>
                                    </button>
                                    <button onclick="selectStyle('Traditional')" class="style-btn group p-4 bg-white rounded-2xl shadow-sm hover:shadow-md transition-all text-center border border-transparent hover:border-brand-teal">
                                        <div class="h-12 w-12 mx-auto bg-brand-concrete rounded-full mb-3 flex items-center justify-center group-hover:bg-brand-teal group-hover:text-white transition-colors"><i data-lucide="home" class="w-5 h-5"></i></div>
                                        <span class="text-xs font-bold text-brand-charcoal">Traditional</span>
                                    </button>
                                    <button onclick="selectStyle('Farmhouse')" class="style-btn group p-4 bg-white rounded-2xl shadow-sm hover:shadow-md transition-all text-center border border-transparent hover:border-brand-teal">
                                        <div class="h-12 w-12 mx-auto bg-brand-concrete rounded-full mb-3 flex items-center justify-center group-hover:bg-brand-teal group-hover:text-white transition-colors"><i data-lucide="warehouse" class="w-5 h-5"></i></div>
                                        <span class="text-xs font-bold text-brand-charcoal">Farmhouse</span>
                                    </button>
                                    <button onclick="selectStyle('Coastal')" class="style-btn group p-4 bg-white rounded-2xl shadow-sm hover:shadow-md transition-all text-center border border-transparent hover:border-brand-teal">
                                        <div class="h-12 w-12 mx-auto bg-brand-concrete rounded-full mb-3 flex items-center justify-center group-hover:bg-brand-teal group-hover:text-white transition-colors"><i data-lucide="sun" class="w-5 h-5"></i></div>
                                        <span class="text-xs font-bold text-brand-charcoal">Coastal</span>
                                    </button>
                                </div>
                            </div>
                            <!-- STEP 2: Basics + Persona -->
                            <div id="step-2" class="step-content hidden fade-in">
                                <h3 class="text-xl font-bold text-brand-charcoal mb-1">The Basics.</h3>
                                <p class="text-xs text-gray-400 mb-6 font-bold uppercase tracking-wide">Define your space needs.</p>
                                <div class="space-y-6 bg-white p-6 rounded-3xl shadow-sm">
                                    <div>
                                        <label class="text-xs font-bold text-gray-400 uppercase">Persona</label>
                                        <div class="flex gap-2 mt-2">
                                            <button onclick="setPersona('Family')" class="persona-btn flex-1 py-3 bg-brand-concrete rounded-xl text-xs font-bold hover:bg-brand-teal hover:text-white transition-colors text-brand-charcoal">Growing Family</button>
                                            <button onclick="setPersona('Couple')" class="persona-btn flex-1 py-3 bg-brand-concrete rounded-xl text-xs font-bold hover:bg-brand-teal hover:text-white transition-colors text-brand-charcoal">Pro Couple</button>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-2"><label class="text-xs font-bold text-brand-charcoal">Bedrooms</label><span id="bed-val" class="text-xs font-bold text-brand-teal">3</span></div>
                                        <input type="range" min="2" max="6" value="3" oninput="updateRange('bed', this.value)">
                                    </div>
                                    <div>
                                        <div class="flex justify-between mb-2"><label class="text-xs font-bold text-brand-charcoal">Max Budget</label><span id="budget-val" class="text-xs font-bold text-brand-teal">$500k</span></div>
                                        <input type="range" min="300" max="1500" step="50" value="500" oninput="updateRange('budget', this.value)">
                                    </div>
                                    <button onclick="nextStep('amenities')" class="w-full py-4 bg-brand-charcoal text-white rounded-xl font-bold text-sm shadow-lg">Next Step</button>
                                </div>
                            </div>
                             <!-- STEP Amenities -->
                             <div id="step-amenities" class="step-content hidden fade-in">
                                <h3 class="text-xl font-bold text-brand-charcoal mb-1">Must Haves.</h3>
                                <p class="text-xs text-gray-400 mb-6 font-bold uppercase tracking-wide">Select top 3.</p>
                                <div class="flex flex-col gap-3 mb-6">
                                    <button onclick="toggleAmenity(this, 'Office')" class="amenity-btn w-full p-4 bg-white rounded-2xl text-left font-bold text-sm text-brand-charcoal border border-transparent hover:border-brand-teal flex items-center gap-3"><i data-lucide="laptop" class="w-4 h-4 text-brand-teal"></i> Home Office</button>
                                    <button onclick="toggleAmenity(this, '3-Car Garage')" class="amenity-btn w-full p-4 bg-white rounded-2xl text-left font-bold text-sm text-brand-charcoal border border-transparent hover:border-brand-teal flex items-center gap-3"><i data-lucide="car" class="w-4 h-4 text-brand-teal"></i> 3-Car Garage</button>
                                    <button onclick="toggleAmenity(this, 'Pool Ready')" class="amenity-btn w-full p-4 bg-white rounded-2xl text-left font-bold text-sm text-brand-charcoal border border-transparent hover:border-brand-teal flex items-center gap-3"><i data-lucide="waves" class="w-4 h-4 text-brand-teal"></i> Pool Ready</button>
                                </div>
                                <button onclick="nextStep('3')" class="w-full py-4 bg-brand-charcoal text-white rounded-xl font-bold text-sm shadow-lg">Get VIP Status</button>
                            </div>
                            <!-- STEP 3: Verify -->
                            <div id="step-3" class="step-content hidden fade-in">
                                <h3 class="text-xl font-bold text-brand-charcoal mb-1">Get Taken Seriously.</h3>
                                <p class="text-xs text-gray-400 mb-6 font-bold uppercase tracking-wide">Verification stops you from being ignored.</p>
                                <div class="bg-brand-teal/10 p-4 rounded-2xl mb-6 flex items-center gap-3 border border-brand-teal/20">
                                    <div class="w-8 h-8 rounded-full bg-brand-teal flex items-center justify-center text-white"><i data-lucide="shield-check" class="w-4 h-4"></i></div>
                                    <span class="text-xs font-bold text-brand-teal">Verified Proof of Funds</span>
                                </div>
                                <button onclick="verifyUser(event)" class="w-full py-4 bg-white border-2 border-brand-border text-brand-charcoal rounded-xl font-bold text-sm mb-3 hover:border-brand-teal transition-colors">Upload Pre-Approval</button>
                                <button onclick="verifyUser(event)" class="w-full py-4 bg-white border-2 border-brand-border text-brand-charcoal rounded-xl font-bold text-sm hover:border-brand-teal transition-colors">Connect Bank via Plaid</button>
                                
                                <div class="mt-4 flex items-center justify-center gap-2 text-[10px] text-gray-400">
                                    <i data-lucide="lock" class="w-3 h-3"></i>
                                    <span>Bank-level 256-bit encryption. We never see your login.</span>
                                </div>
                            </div>
                            
                            <!-- STEP 4: Success/Dashboard -->
                            <div id="step-4" class="step-content hidden fade-in text-center pt-8">
                                <div class="w-16 h-16 bg-brand-charcoal rounded-full flex items-center justify-center mx-auto mb-4 shadow-xl border-4 border-brand-teal animate-bounce">
                                    <i data-lucide="crown" class="w-8 h-8 text-brand-teal"></i>
                                </div>
                                <h3 class="text-xl font-bold text-brand-charcoal mb-1">You are VIP!</h3>
                                <p class="text-xs text-gray-500 mb-6">Alias: <span class="font-mono font-bold bg-white px-2 py-1 rounded border border-gray-200">Buyer #8942</span></p>

                                <!-- AI Bio Section -->
                                <div class="mb-6 px-1">
                                    <div id="ai-bio-container" class="hidden p-3 bg-white border border-brand-teal/20 rounded-xl text-left mb-3 shadow-sm">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="text-xs font-bold uppercase text-brand-teal tracking-wider">AI Bio</span>
                                        </div>
                                        <p id="ai-bio-text" class="text-xs text-gray-600 italic leading-relaxed"></p>
                                    </div>
                                    <button onclick="generateBuyerBio()" id="btn-generate-bio" class="w-full py-2.5 bg-white border border-brand-border text-brand-teal font-bold rounded-xl text-xs hover:bg-brand-teal/5 hover:border-brand-teal transition-colors flex items-center justify-center gap-2 shadow-sm">
                                        <span>✨</span> Enhance Profile with AI
                                    </button>
                                </div>

                                <div id="buyer-pitches-container" class="mt-4 text-left">
                                    <div class="p-4 rounded-xl border border-dashed border-gray-300 bg-gray-50 text-center">
                                        <p class="text-[10px] text-gray-400 italic">Waiting for builder proposals...</p>
                                        <div class="mt-2 flex justify-center gap-1">
                                            <div class="w-1.5 h-1.5 bg-gray-300 rounded-full animate-bounce"></div>
                                            <div class="w-1.5 h-1.5 bg-gray-300 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                            <div class="w-1.5 h-1.5 bg-gray-300 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="resetDemo()" class="mt-6 text-xs text-gray-400 hover:text-brand-teal underline">Reset Demo</button>
                            </div>
                        </div>
                        <!-- App Footer -->
                        <div class="h-16 bg-white border-t border-brand-border flex justify-around items-center px-2">
                            <button class="p-2"><i data-lucide="home" class="w-5 h-5 text-brand-teal"></i></button>
                            <button class="p-2"><i data-lucide="heart" class="w-5 h-5 text-gray-300"></i></button>
                            <button class="p-2"><i data-lucide="message-square" class="w-5 h-5 text-gray-300"></i></button>
                        </div>
                    </div>
                </div>

                <!-- RIGHT: Builder Dashboard -->
                <div class="lg:col-span-8 h-[600px] lg:h-[700px] flex flex-col">
                    <div class="mb-6 pl-4 border-l-4 border-brand-gold">
                        <span class="text-xs font-bold uppercase text-yellow-600 dark:text-brand-gold tracking-widest" id="demo-view-label">Builder View</span>
                        <h3 class="text-xl font-bold text-brand-charcoal dark:text-white" id="demo-view-title">Demand Command Center</h3>
                    </div>
                    <div id="builder-dashboard-container" class="flex-1 bg-brand-charcoal rounded-3xl shadow-2xl overflow-hidden flex flex-col border border-gray-800 relative">
                        <!-- Top Bar -->
                        <div class="h-16 bg-gray-900 border-b border-gray-800 flex items-center justify-between px-6">
                            <div class="flex items-center gap-3">
                                <div class="flex gap-1.5"><div class="w-3 h-3 rounded-full bg-red-500"></div><div class="w-3 h-3 rounded-full bg-yellow-500"></div><div class="w-3 h-3 rounded-full bg-green-500"></div></div>
                                <span class="ml-4 font-mono text-xs text-gray-500">TERMINAL_V2</span>
                                <span class="px-2 py-0.5 bg-brand-teal/20 text-brand-teal text-[10px] font-bold rounded animate-pulse">LIVE</span>
                            </div>
                            <div class="flex bg-gray-800 rounded-lg p-1">
                                <button onclick="toggleDashboardView('list')" id="view-list-btn" class="px-4 py-1.5 rounded-md text-xs font-bold bg-brand-gold text-brand-charcoal transition-all">Feed</button>
                                <button onclick="toggleDashboardView('map')" id="view-map-btn" class="px-4 py-1.5 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all">Map</button>
                                <button onclick="toggleDashboardView('intel')" id="view-intel-btn" class="px-4 py-1.5 rounded-md text-xs font-bold text-gray-400 hover:text-white transition-all">Intel</button>
                            </div>
                        </div>
                        <!-- Stats Bar with Animated Counters -->
                        <div class="grid grid-cols-4 border-b border-gray-800 bg-gray-900/50">
                            <div class="p-4 border-r border-gray-800"><div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Active Buyers</div><div class="text-xl font-mono font-bold text-white counter" data-target="1248" id="stat-active">0</div></div>
                            <div class="p-4 border-r border-gray-800"><div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Avg Budget</div><div class="text-xl font-mono font-bold text-brand-gold">$485k</div></div>
                            <div class="p-4 border-r border-gray-800"><div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Credits</div><div class="text-xl font-mono font-bold text-white" id="stat-credits">500</div></div>
                            <div class="p-4"><div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider">Conversion</div><div class="text-xl font-mono font-bold text-green-400">18.4%</div></div>
                        </div>
                        <!-- Content Area -->
                        <div id="builder-dashboard-body" class="flex-1 relative bg-brand-charcoal overflow-hidden">
                            <!-- List View -->
                            <div id="dashboard-list-view" class="absolute inset-0 overflow-y-auto p-4 space-y-2"></div>
                            
                            <!-- Map View -->
                            <div id="dashboard-map-view" class="absolute inset-0 hidden">
                                <canvas id="demandMap" class="w-full h-full"></canvas>
                                <div class="absolute bottom-4 left-4 bg-gray-900/90 backdrop-blur px-4 py-2 rounded-lg text-xs font-bold text-white border border-gray-700">
                                    <span class="text-brand-teal">●</span> Your Lots &nbsp; <span class="text-brand-gold">●</span> Demand Heat
                                </div>
                            </div>

                             <!-- Intel View -->
                             <div id="dashboard-intel-view" class="absolute inset-0 hidden p-6 overflow-y-auto">
                                <div class="grid grid-cols-2 gap-6 h-full">
                                    <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700">
                                        <h4 class="text-xs font-bold text-gray-400 uppercase mb-4">Feature Demand</h4>
                                        <div class="space-y-4">
                                            <div><div class="flex justify-between text-xs text-gray-400 mb-1"><span>Home Office</span><span class="text-brand-gold font-mono">42%</span></div><div class="h-1 bg-gray-700 rounded-full"><div class="h-full bg-brand-gold w-[42%] rounded-full"></div></div></div>
                                            <div><div class="flex justify-between text-xs text-gray-400 mb-1"><span>3-Car Garage</span><span class="text-gray-500 font-mono">28%</span></div><div class="h-1 bg-gray-700 rounded-full"><div class="h-full bg-indigo-500 w-[28%] rounded-full"></div></div></div>
                                        </div>
                                    </div>
                                    <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700">
                                        <h4 class="text-xs font-bold text-gray-400 uppercase mb-4">Budget Trend</h4>
                                        <div class="h-32 w-full"><canvas id="intelChart"></canvas></div>
                                    </div>
                                </div>
                            </div>

                            <!-- CARD OVERLAY -->
                            <div id="user-card-overlay" class="absolute bottom-0 left-0 right-0 bg-gray-900/95 border-t border-brand-gold p-6 transform translate-y-full transition-transform duration-500 backdrop-blur-md z-20">
                                <div class="flex justify-between items-start mb-4">
                                    <div><div class="flex items-center gap-2 mb-1"><span class="w-2 h-2 bg-brand-gold rounded-full animate-pulse"></span><span class="text-xs font-bold text-brand-gold uppercase">Match Found</span></div><h4 class="text-white font-bold text-xl">VIP Buyer #8942</h4></div>
                                    <div class="text-right"><div class="text-2xl font-mono font-bold text-brand-gold" id="dash-card-budget">$500k</div><div class="text-[10px] text-gray-500 uppercase font-bold">Verified Budget</div></div>
                                </div>
                                <div class="grid grid-cols-3 gap-4 mb-6">
                                    <div class="bg-gray-800 p-3 rounded-xl"><div class="text-[10px] text-gray-500 uppercase font-bold">Style</div><div class="text-white font-bold text-sm" id="dash-card-style">Modern</div></div>
                                    <div class="bg-gray-800 p-3 rounded-xl"><div class="text-[10px] text-gray-500 uppercase font-bold">Specs</div><div class="text-white font-bold text-sm" id="dash-card-config">3bd / 2ba</div></div>
                                    <div class="bg-gray-800 p-3 rounded-xl"><div class="text-[10px] text-gray-500 uppercase font-bold">Must Have</div><div class="text-white font-bold text-sm truncate" id="dash-card-amenities">...</div></div>
                                </div>
                                <div id="unlock-area">
                                    <button onclick="unlockLead()" id="btn-unlock" class="w-full py-4 bg-brand-gold text-brand-charcoal font-bold rounded-xl hover:bg-white transition-colors flex items-center justify-center gap-2"><i data-lucide="lock-open" class="w-4 h-4"></i> UNLOCK & PITCH (50 Credits)</button>
                                </div>
                            </div>

                            <!-- PITCH MODAL -->
                            <div id="pitch-modal" class="absolute inset-0 bg-black/80 z-30 hidden flex items-center justify-center p-4 backdrop-blur-sm">
                                <div class="bg-gray-800 border border-gray-600 rounded-2xl p-6 w-full max-w-sm shadow-2xl">
                                    <h4 class="text-white font-bold mb-1 text-lg">Match Inventory to Buyer <span class="text-brand-gold font-mono">#8942</span></h4>
                                    <p class="text-xs text-gray-400 mb-4">Select standing inventory to offer.</p>
                                    
                                    <div class="mb-4 relative">
                                        <textarea id="pitch-message" class="w-full bg-gray-900 border border-gray-600 text-white text-xs rounded-xl p-3 focus:border-brand-gold outline-none h-24 resize-none leading-relaxed" placeholder="Drafting pitch..."></textarea>
                                        <button onclick="generateBuilderPitch()" id="btn-ai-pitch" class="absolute bottom-2 right-2 text-[10px] bg-brand-gold hover:bg-white text-brand-charcoal px-2 py-1 rounded-lg flex items-center gap-1 transition-colors font-bold shadow-sm"><span>✨</span> AI Draft</button>
                                    </div>

                                    <div class="space-y-2 mb-6">
                                        <button onclick="selectPitch(this)" class="pitch-opt w-full text-left p-3 rounded-xl bg-gray-700 border border-gray-600 hover:border-brand-gold hover:bg-gray-600 transition-all text-xs text-gray-300 group">
                                            <div class="flex justify-between mb-1"><span class="font-bold text-white group-hover:text-brand-gold"><i data-lucide="home" class="inline w-3 h-3 mr-2"></i> Move-In Ready (QMI)</span><span class="text-green-400 font-mono">Immediate Close</span></div>
                                        </button>
                                    </div>
                                    <div class="flex gap-3">
                                        <button onclick="document.getElementById('pitch-modal').classList.add('hidden')" class="flex-1 py-3 bg-gray-700 hover:bg-gray-600 text-gray-300 rounded-xl text-xs font-bold">Cancel</button>
                                        <button onclick="sendPitch()" class="flex-1 py-3 bg-brand-gold hover:bg-white text-brand-charcoal rounded-xl text-xs font-bold">Send Offer</button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Success Stories (Transaction Receipts) -->
    <section id="testimonials" class="py-24 bg-brand-concrete dark:bg-gray-900 transition-colors scroll-mt-28">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-16 text-center reveal-on-scroll">
                <h2 id="testimonial-title" class="text-3xl font-extrabold text-brand-charcoal dark:text-white">Recent Market Activity</h2>
                <p id="testimonial-desc" class="mt-4 text-brand-muted dark:text-gray-300">Live transaction feed.</p>
            </div>
            <div id="testimonials-grid" class="grid md:grid-cols-3 gap-8 reveal-on-scroll">
                <!-- JS Filled -->
            </div>
        </div>
    </section>

    <!-- Pricing (Buyer - Membership Tiers) -->
    <section id="pricing-buyer" class="py-24 bg-white/50 dark:bg-brand-charcoal border-y border-brand-border dark:border-gray-800 transition-colors scroll-mt-28" data-audience="buyer">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16 reveal-on-scroll">
                <h2 class="text-3xl md:text-4xl font-extrabold text-brand-charcoal dark:text-white">Zero Risk. Infinite Upside.</h2>
                <p class="mt-4 text-gray-500">Stop chasing. Start demanding.</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 mb-16 reveal-on-scroll max-w-4xl mx-auto">
                <!-- Browser Level -->
                <div class="p-8 rounded-3xl bg-brand-concrete/50 dark:bg-gray-800/50 border border-brand-border dark:border-gray-700 opacity-80 hover:opacity-100 transition-all">
                    <h3 class="text-lg font-bold text-gray-500 uppercase tracking-widest mb-4">The Browser</h3>
                    <div class="text-4xl font-extrabold text-gray-400 mb-6">$0</div>
                    <ul class="space-y-4 text-sm text-gray-500 mb-8">
                        <li class="flex gap-2"><i data-lucide="check" class="w-5 h-5"></i> View Heatmap Data</li>
                        <li class="flex gap-2"><i data-lucide="check" class="w-5 h-5"></i> Build "Buy Box"</li>
                        <li class="flex gap-2"><i data-lucide="x" class="w-5 h-5 text-gray-300"></i> Receive Builder Bids</li>
                    </ul>
                    <button class="w-full py-3 border-2 border-gray-300 text-gray-400 font-bold rounded-xl text-sm" disabled>Basic Access</button>
                </div>

                <!-- Verified Gold -->
                <div class="p-8 rounded-3xl bg-white dark:bg-gray-800 border-2 border-brand-gold shadow-glow-gold relative overflow-hidden group">
                    <div class="absolute top-0 right-0 bg-brand-gold text-brand-charcoal text-[10px] font-bold px-3 py-1 rounded-bl-xl uppercase tracking-widest">Recommended</div>
                    <h3 class="text-lg font-bold text-brand-gold uppercase tracking-widest mb-4">Verified Gold</h3>
                    <div class="text-4xl font-extrabold text-brand-charcoal dark:text-white mb-6">$0</div>
                    <ul class="space-y-4 text-sm text-brand-charcoal dark:text-gray-300 mb-8 font-medium">
                        <li class="flex gap-2"><i data-lucide="check" class="w-5 h-5 text-brand-gold"></i> <span class="font-bold">Receive Off-Market Bids</span></li>
                        <li class="flex gap-2"><i data-lucide="check" class="w-5 h-5 text-brand-gold"></i> Hide Identity</li>
                        <li class="flex gap-2"><i data-lucide="check" class="w-5 h-5 text-brand-gold"></i> Access Incentives</li>
                    </ul>
                    <button onclick="openWaitlistModal()" class="w-full py-3 bg-brand-gold text-brand-charcoal font-bold rounded-xl text-sm hover:bg-white transition-all shadow-lg">Start Receiving Bids</button>
                    <div class="mt-2 text-center text-[10px] text-gray-500 font-bold uppercase tracking-wider flex items-center justify-center gap-1">
                        <i data-lucide="shield-check" class="w-3 h-3 text-brand-gold"></i> Verified by Plaid
                    </div>
                </div>
            </div>

            <!-- Value Stack Table -->
            <div class="bg-white dark:bg-gray-800 rounded-3xl p-8 border border-brand-border dark:border-gray-700 reveal-on-scroll">
                <h4 class="font-bold text-brand-charcoal dark:text-white mb-6 text-center">Negotiating Power</h4>
                <div class="grid grid-cols-3 gap-4 text-sm border-b border-gray-200 dark:border-gray-700 pb-2 mb-4 font-bold text-gray-400 uppercase tracking-wider text-[10px]">
                    <div>Feature</div>
                    <div class="text-center">Traditional</div>
                    <div class="text-center text-brand-teal">Newer Market</div>
                </div>
                <div class="space-y-4">
                    <div class="grid grid-cols-3 gap-4 items-center">
                        <div class="font-medium text-brand-charcoal dark:text-gray-300">Market Access</div>
                        <div class="text-center text-gray-400">Beg for showing</div>
                        <div class="text-center font-bold text-brand-teal">Builders pitch you</div>
                    </div>
                    <div class="grid grid-cols-3 gap-4 items-center">
                        <div class="font-medium text-brand-charcoal dark:text-gray-300">Competition</div>
                        <div class="text-center text-gray-400">Bidding Wars</div>
                        <div class="text-center font-bold text-brand-teal">You are the prize</div>
                    </div>
                    <div class="grid grid-cols-3 gap-4 items-center">
                        <div class="font-medium text-brand-charcoal dark:text-gray-300">Incentives</div>
                        <div class="text-center text-gray-400">If lucky</div>
                        <div class="text-center font-bold text-brand-teal">Builder Rate Buy-Downs</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Pricing (Builder - ROI Calculator) -->
    <section id="pricing-builder" class="py-24 bg-brand-charcoal text-white hidden transition-colors scroll-mt-28" data-audience="builder">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16 reveal-on-scroll"><h2 class="text-3xl md:text-4xl font-extrabold text-white">CAC Engine</h2><p class="text-gray-400 mt-4">Stop burning cash on ads for tire-kickers.</p></div>
            
            <div class="grid lg:grid-cols-2 gap-12 items-center reveal-on-scroll">
                <!-- Calculator Panel -->
                <div class="bg-gray-900 border border-gray-800 rounded-3xl p-8 shadow-2xl relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-brand-gold to-transparent"></div>
                    <h3 class="text-xl font-bold text-white mb-8 flex items-center gap-2"><i data-lucide="calculator" class="w-5 h-5 text-brand-gold"></i> Cost to Acquire Customer</h3>
                    
                    <!-- Old Way -->
                    <div class="mb-6 p-4 rounded-xl bg-red-900/10 border border-red-900/30">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold text-red-400 uppercase">The Old Way</span>
                            <span class="font-mono font-bold text-white">$17,000</span>
                        </div>
                        <div class="text-[10px] text-gray-500 flex justify-between">
                            <span>Realtor Comm (3%)</span>
                            <span>$15,000</span>
                        </div>
                        <div class="text-[10px] text-gray-500 flex justify-between">
                            <span>Zillow/Ads</span>
                            <span>$2,000</span>
                        </div>
                    </div>

                    <!-- Newer Way -->
                    <div class="mb-8 p-4 rounded-xl bg-brand-gold/10 border border-brand-gold/30">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xs font-bold text-brand-gold uppercase">Newer Market</span>
                            <span class="font-mono font-bold text-white">$2,650</span>
                        </div>
                        <div class="text-[10px] text-gray-400 flex justify-between">
                            <span>Success Fee (0.5%)</span>
                            <span>$2,500</span>
                        </div>
                        <div class="text-[10px] text-gray-400 flex justify-between">
                            <span>Match Fee</span>
                            <span>$150</span>
                        </div>
                    </div>

                    <div class="border-t border-gray-800 pt-6">
                        <div class="flex justify-between items-end mb-2">
                            <label class="text-xs font-bold text-gray-400 uppercase">Annual Volume</label>
                            <span class="font-mono text-brand-gold font-bold text-lg" id="roi-homes">10 Homes</span>
                        </div>
                        <input type="range" min="1" max="100" value="10" class="w-full mb-6 accent-brand-gold bg-gray-700 h-2 rounded-lg appearance-none cursor-pointer" oninput="updateROI(this.value)">
                        
                        <div class="text-center">
                            <div class="text-sm text-gray-500 mb-1">Projected Annual Savings</div>
                            <div class="text-4xl font-mono font-bold text-green-400" id="roi-savings">$143,500</div>
                        </div>
                    </div>
                </div>

                <!-- Text Side -->
                <div class="space-y-8">
                    <div class="flex gap-4">
                        <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-brand-gold shrink-0 border border-gray-700"><i data-lucide="target" class="w-6 h-6"></i></div>
                        <div>
                            <h4 class="font-bold text-xl text-white">Precision Targeting</h4>
                            <p class="text-gray-400 text-sm mt-2">Don't spray and pray. Filter for buyers with verified funds who specifically requested your lot size and price point.</p>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-brand-gold shrink-0 border border-gray-700"><i data-lucide="zap" class="w-6 h-6"></i></div>
                        <div>
                            <h4 class="font-bold text-xl text-white">Zero Carry Costs</h4>
                            <p class="text-gray-400 text-sm mt-2">Match standing inventory to ready buyers in minutes, not months. Reduce loan interest payments instantly.</p>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <div class="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center text-brand-gold shrink-0 border border-gray-700"><i data-lucide="database" class="w-6 h-6"></i></div>
                        <div>
                            <h4 class="font-bold text-xl text-white">Seamless Integration</h4>
                            <p class="text-gray-400 text-sm mt-2">Export lead data directly to Salesforce, HubSpot, or your proprietary CRM via our robust API.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CTA BUYER (Bottom) -->
    <section id="cta-buyer" class="py-20 bg-brand-teal text-white transition-colors scroll-mt-28" data-audience="buyer">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-3xl font-extrabold mb-6">Stop Searching. Start Receiving.</h2>
            <button onclick="openWaitlistModal()" class="bg-white text-brand-teal px-8 py-4 rounded-full font-bold shadow-lg hover:shadow-xl hover:-translate-y-1 transition-all">Start Receiving Bids</button>
             <div class="mt-4 flex items-center justify-center gap-1.5 text-xs font-bold text-white/80 uppercase tracking-wider">
                <i data-lucide="shield-check" class="w-4 h-4"></i> Verified by Plaid
            </div>
            <!-- FOMO Counter (Buyer Side) -->
            <p id="buyer-fomo-text" class="text-sm text-white/90 mt-6 font-mono font-bold animate-pulse">● 3 Builders in your zip code are ready to bid.</p>
        </div>
    </section>

    <!-- CTA BUILDER (Bottom) -->
    <section id="cta-builder" class="py-20 bg-gray-900 text-white hidden transition-colors scroll-mt-28" data-audience="builder">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <h2 class="text-3xl font-extrabold mb-6">Eliminate Spec Risk.</h2>
            <button onclick="openWaitlistModal()" class="bg-brand-gold text-brand-charcoal px-8 py-4 rounded-full font-bold shadow-lg hover:shadow-glow-gold hover:-translate-y-1 transition-all">Search Buyer Demand</button>
            <!-- FOMO Counter -->
            <p id="builder-fomo-text" class="text-sm text-brand-gold mt-6 font-mono font-bold animate-pulse">● 12 Verified Buyers in your zip code are waiting.</p>
        </div>
    </section>

    <!-- The Newer Way (AI FAQ) -->
    <section id="faq" class="py-24 bg-brand-concrete dark:bg-gray-900 border-t border-brand-border dark:border-gray-800 transition-colors scroll-mt-28">
        <div class="max-w-3xl mx-auto px-4">
            <h2 class="text-3xl font-extrabold text-brand-charcoal dark:text-white text-center mb-8">The Newer Way</h2>
            <p class="text-center text-gray-500 dark:text-gray-400 mb-12" id="faq-subtext">Ask us anything about buying or building.</p>
            
            <div class="bg-white dark:bg-gray-800 rounded-3xl border border-brand-border dark:border-gray-700 shadow-xl overflow-hidden flex flex-col h-[500px]">
                <!-- Chat History -->
                <div id="chat-history" class="flex-1 p-6 overflow-y-auto space-y-4 scrollbar-hide">
                    <div class="chat-bubble ai">
                        Hi there! I'm your Newer Assistant. Ask me anything about the marketplace, verified leads, or how to get started.
                    </div>
                </div>

                <!-- Suggested Chips -->
                <div class="p-4 bg-gray-50 dark:bg-gray-900/50 border-t border-brand-border dark:border-gray-700 overflow-x-auto whitespace-nowrap scrollbar-hide" id="chat-chips">
                    <!-- JS Injected -->
                </div>

                <!-- Input Area -->
                <div class="p-4 bg-white dark:bg-gray-800 border-t border-brand-border dark:border-gray-700">
                    <form onsubmit="handleChatSubmit(event)" class="relative">
                        <input type="text" id="chat-input" placeholder="Type your question..." class="w-full bg-brand-concrete dark:bg-gray-700 dark:text-white rounded-full pl-6 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-brand-teal dark:focus:ring-brand-gold transition-all">
                        <button type="submit" class="absolute right-2 top-2 p-1.5 bg-brand-charcoal text-white rounded-full hover:bg-brand-teal dark:hover:bg-brand-gold transition-colors">
                            <i data-lucide="arrow-up" class="w-4 h-4"></i>
                        </button>
                    </form>
                    <div class="text-[10px] text-gray-400 text-center mt-2 flex items-center justify-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Live AI Agent
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-brand-charcoal dark:bg-black pt-20 pb-32 md:pb-10 text-gray-400 text-sm transition-colors">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-12 mb-16">
                <div class="col-span-1">
                     <a href="#" class="flex items-center gap-2 group text-2xl mb-6" onclick="window.scrollTo({top: 0, behavior: 'smooth'});">
                        <div class="h-[1.15em] w-[1.15em] flex items-center justify-center">
                            <svg class="h-full w-full block transition-transform group-hover:scale-110 duration-300 ease-out" viewBox="0 0 100 100" fill="none">
                                <path id="footer-logo-path-1" d="M20 80 V35 L50 20 L50 55 L20 80 Z" fill="#0D9488" stroke="#0D9488" stroke-width="6" stroke-linejoin="round" class="theme-transition"/>
                                <path id="footer-logo-path-2" d="M80 20 V65 L50 80 L50 45 L80 20 Z" fill="#0D9488" stroke="#0D9488" stroke-width="6" stroke-linejoin="round" class="theme-transition"/>
                            </svg>
                        </div>
                        <span class="font-extrabold tracking-tight leading-none text-white">Newer</span>
                    </a>
                    <p class="leading-relaxed mt-4 mb-6 text-gray-500">The Newer Way Home.</p>
                    
                    <!-- Added Socials for Improvement -->
                    <div class="flex gap-4">
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-teal dark:hover:bg-brand-gold hover:text-white dark:hover:text-brand-charcoal transition-all"><i data-lucide="twitter" class="w-5 h-5"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-teal dark:hover:bg-brand-gold hover:text-white dark:hover:text-brand-charcoal transition-all"><i data-lucide="linkedin" class="w-5 h-5"></i></a>
                        <a href="#" class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center hover:bg-brand-teal dark:hover:bg-brand-gold hover:text-white dark:hover:text-brand-charcoal transition-all"><i data-lucide="instagram" class="w-5 h-5"></i></a>
                    </div>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-6 uppercase tracking-wider text-xs">Platform</h4>
                    <ul class="space-y-4">
                        <li><a href="#" class="hover:text-brand-teal dark:hover:text-brand-gold transition-colors">For Buyers</a></li>
                        <li><a href="#" class="hover:text-brand-teal dark:hover:text-brand-gold transition-colors">For Builders</a></li>
                        <!-- Local SEO Links -->
                        <li class="pt-4 text-[10px] uppercase font-bold text-gray-600 tracking-wider">Markets</li>
                        <li><a href="#" class="hover:text-brand-teal transition-colors">New Homes in Austin</a></li>
                        <li><a href="#" class="hover:text-brand-teal transition-colors">New Homes in Dallas</a></li>
                        <li><a href="#" class="hover:text-brand-teal transition-colors">New Homes in Houston</a></li>
                    </ul>
                </div>
                <div><h4 class="text-white font-bold mb-6 uppercase tracking-wider text-xs">Company</h4><ul class="space-y-4"><li><a href="#" class="hover:text-brand-teal dark:hover:text-brand-gold transition-colors">About</a></li><li><a href="#" class="hover:text-brand-teal dark:hover:text-brand-gold transition-colors">Careers</a></li></ul></div>
                <div><h4 class="text-white font-bold mb-6 uppercase tracking-wider text-xs">Legal</h4><ul class="space-y-4"><li><a href="#" class="hover:text-brand-teal dark:hover:text-brand-gold transition-colors">Privacy</a></li><li><a href="#" class="hover:text-brand-teal dark:hover:text-brand-gold transition-colors">Terms</a></li></ul></div>
            </div>
            <div class="border-t border-gray-800 pt-8 flex justify-between items-center"><p>&copy; 2025 Newer LLC.</p></div>
        </div>
    </footer>

    <!-- NEW: Mobile Sticky CTA + Nav -->
    <div class="md:hidden fixed bottom-0 left-0 w-full z-50 bg-white dark:bg-brand-charcoal border-t border-gray-200 dark:border-gray-700 shadow-2xl p-4 flex flex-col gap-3 pb-8">
        <!-- Main CTA -->
        <button id="mobile-sticky-cta" onclick="openWaitlistModal()" class="w-full py-3.5 rounded-xl font-bold text-sm bg-brand-teal text-white shadow-lg transition-colors">
            Start Receiving Bids
        </button>
        <!-- Toggle -->
        <div class="flex bg-gray-100 dark:bg-gray-800 rounded-full p-1 relative w-full">
            <button onclick="setAudience('buyer')" class="role-btn-mobile active flex-1 py-2 rounded-full text-xs font-bold transition-all bg-white text-brand-charcoal shadow-sm">Buyers</button>
            <button onclick="setAudience('builder')" class="role-btn-mobile flex-1 py-2 rounded-full text-xs font-bold transition-all text-gray-500 dark:text-gray-400">Builders</button>
        </div>
    </div>

    <!-- Waitlist Modal -->
    <div id="waitlist-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-brand-charcoal/90 dark:bg-black/90 backdrop-blur-sm" onclick="closeWaitlistModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white dark:bg-gray-800 rounded-3xl p-8 shadow-2xl transition-colors">
            <button onclick="closeWaitlistModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 dark:hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button>
            <div class="text-center">
                <div id="waitlist-badge-bg" class="w-20 h-20 bg-brand-concrete rounded-full flex items-center justify-center mx-auto mb-6 transition-colors duration-500">
                    <svg class="w-10 h-10" viewBox="16 16 68 68" fill="none"><path d="M20 80 V35 L50 20 L50 55 L20 80 Z" fill="white" stroke="white" stroke-width="4" stroke-linejoin="round"/><path d="M80 20 V65 L50 80 L50 45 L80 20 Z" fill="white" stroke="white" stroke-width="4" stroke-linejoin="round"/></svg>
                </div>
                <h3 id="waitlist-title" class="text-2xl font-bold text-brand-charcoal dark:text-white mb-2">Get Early Access</h3>
                <p id="waitlist-desc" class="text-gray-500 dark:text-gray-400 text-sm mb-6">Join 4,200+ users.</p>
                <form onsubmit="event.preventDefault(); this.innerHTML='<div class=\'text-center py-10\'><div class=\'text-2xl mb-2\'>🎉</div><div class=\'text-brand-charcoal dark:text-white font-bold text-xl\'>You\'re on the list!</div></div>'">
                    <div class="relative">
                        <input id="email-input" type="email" placeholder="Email Address" required class="w-full bg-brand-concrete dark:bg-gray-700 dark:text-white border-none rounded-xl px-4 py-3 mb-2 focus:ring-2 focus:ring-brand-teal dark:focus:ring-brand-gold outline-none transition-all" oninput="validateEmail(this)">
                        <i id="email-check" data-lucide="check-circle" class="absolute right-3 top-3.5 w-5 h-5 text-green-500 opacity-0 transition-opacity"></i>
                    </div>
                    
                    <input type="text" placeholder="Zip Code" required class="w-full bg-brand-concrete dark:bg-gray-700 dark:text-white border-none rounded-xl px-4 py-3 mb-4 focus:ring-2 focus:ring-brand-teal dark:focus:ring-brand-gold outline-none transition-all">

                    <div class="flex items-center gap-1.5 mb-4 px-1 justify-center md:justify-start"><i data-lucide="lock" class="w-3 h-3 text-gray-400"></i><span id="waitlist-trust-text" class="text-[10px] text-gray-400 font-medium">Secure 256-bit Encryption</span></div>
                    
                    <!-- Hidden Radio logic -->
                    <div class="hidden">
                        <input type="radio" name="role" value="buyer" id="role-buyer-input">
                        <input type="radio" name="role" value="builder" id="role-builder-input">
                    </div>

                    <button id="waitlist-submit-btn" type="submit" class="w-full py-3 bg-brand-charcoal text-white font-bold rounded-xl hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300">Start Receiving Bids</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Logic Script -->
    <script>
        // State
        let appState = { style: '', budget: 500, bedrooms: 3, amenities: [], credits: 500, persona: '' };
        let currentAudience = 'buyer'; 
        let intelChartInstance = null;

        // --- Chat Engine Logic ---
        const chatKnowledgeBase = {
            buyer: {
                intro: "Hi! I'm your Newer Assistant. Ask me how to get builders to bid on your project.",
                prompts: ["How does this work?", "Is it free?", "What builders are here?", "Can I get financing?"],
                answers: {
                    "work": "It's simple: 1. Create a profile (your 'Buy Box'). 2. Verify your funds. 3. Sit back as builders pitch you directly with off-market deals and incentives.",
                    "free": "Yes! Newer is 100% free for buyers. Builders pay us because we save them marketing costs.",
                    "builder": "We work with top national builders like Lennar, Pulte, and Toll Brothers, as well as vetted local custom home builders.",
                    "financ": "Absolutely. You can request rate buy-downs or closing cost credits directly in your profile.",
                    "default": "Great question! Newer flips the script: instead of you chasing listings, builders compete for your business. Create a free profile to see who bids!"
                }
            },
            builder: {
                intro: "Welcome to the Demand Command Center. Ask me about lead quality, absorption, or integration.",
                prompts: ["How are leads verified?", "What is the cost?", "Does it integrate with CRM?", "What is 'Spec Risk'?"],
                answers: {
                    "verif": "We use Plaid to verify liquid funds or mortgage pre-approvals in real-time. You never waste time on unqualified leads.",
                    "cost": "There is $0 platform fee to list. You pay a small match fee to unlock contact info, and a success fee only upon closing.",
                    "crm": "Yes. We push verified leads directly to Salesforce, HubSpot, and BuildTrend via our robust API.",
                    "spec": "Spec risk is building without a buyer. Newer eliminates this by giving you a live order book of ready buyers before you break ground.",
                    "default": "Newer helps you build pre-sold. Access our live map of verified demand to eliminate speculation and reduce carry costs."
                }
            }
        };

        function initChat(role) {
            const kb = chatKnowledgeBase[role];
            const history = document.getElementById('chat-history');
            const chips = document.getElementById('chat-chips');
            
            // Reset
            history.innerHTML = `<div class="chat-bubble ai">
                        ${kb.intro}
                    </div>`;
            
            // Set Chips
            chips.innerHTML = '';
            kb.prompts.forEach(p => {
                const btn = document.createElement('button');
                btn.className = `inline-block px-4 py-2 rounded-full text-xs font-bold mr-2 transition-all ${role === 'builder' ? 'bg-gray-800 text-brand-gold border border-brand-gold hover:bg-brand-gold hover:text-brand-charcoal' : 'bg-white text-brand-teal border border-brand-teal hover:bg-brand-teal hover:text-white'}`;
                btn.innerText = p;
                btn.onclick = () => handleChatSubmit(null, p);
                chips.appendChild(btn);
            });
        }

        function handleChatSubmit(e, textOverride) {
            if(e) e.preventDefault();
            const input = document.getElementById('chat-input');
            const txt = textOverride || input.value;
            if(!txt) return;
            
            const history = document.getElementById('chat-history');
            
            // Add User Msg
            const userBubble = document.createElement('div');
            userBubble.className = `chat-bubble user mb-4`;
            userBubble.innerText = txt;
            history.appendChild(userBubble);
            
            if(!textOverride) input.value = '';
            history.scrollTop = history.scrollHeight;

            // Simulate Thinking
            const typingBubble = document.createElement('div');
            typingBubble.className = "chat-bubble ai mb-4";
            typingBubble.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
            history.appendChild(typingBubble);
            history.scrollTop = history.scrollHeight;

            setTimeout(() => {
                typingBubble.remove();
                const aiBubble = document.createElement('div');
                aiBubble.className = "chat-bubble ai mb-4";
                
                // Logic
                const kb = chatKnowledgeBase[currentAudience];
                let response = kb.answers.default;
                const lower = txt.toLowerCase();
                
                if(lower.includes('work') || lower.includes('how')) response = kb.answers.work || kb.answers.verif;
                if(lower.includes('free') || lower.includes('cost') || lower.includes('price')) response = kb.answers.free || kb.answers.cost;
                if(lower.includes('builder') || lower.includes('crm')) response = kb.answers.builder || kb.answers.crm;
                if(lower.includes('financ') || lower.includes('spec')) response = kb.answers.financ || kb.answers.spec;
                
                aiBubble.innerText = response;
                history.appendChild(aiBubble);
                history.scrollTop = history.scrollHeight;
            }, 1000);
        }

        // Helper function for safe class manipulation
        function toggleClass(id, className, action) {
            const el = document.getElementById(id);
            if (el) {
                if (action === 'add') el.classList.add(className);
                else if (action === 'remove') el.classList.remove(className);
            }
        }
        
        // --- Map Data ---
        const heatMapPoints = Array.from({length: 40}, () => ({ x: Math.random(), y: Math.random(), r: 20 + Math.random() * 40 }));
        
        // --- Scroll Reveal Logic ---
        const observerOptions = { root: null, rootMargin: '0px', threshold: 0.1 };
        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if(entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    // Check if it has a counter
                    const counters = entry.target.querySelectorAll('.counter');
                    counters.forEach(c => animateCounter(c));
                    if(entry.target.id === 'testimonials-grid') {
                        // Stagger effect for receipts
                        const receipts = entry.target.querySelectorAll('.receipt-card');
                        receipts.forEach((el, i) => {
                            setTimeout(() => el.querySelector('.stamp-container').classList.add('animate-stamp'), i * 300 + 500);
                        });
                    }
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        document.querySelectorAll('.reveal-on-scroll').forEach(el => observer.observe(el));

        function animateCounter(el) {
            const target = parseInt(el.dataset.target);
            let count = 0;
            const increment = target / 50; 
            const timer = setInterval(() => {
                count += increment;
                if(count >= target) { count = target; clearInterval(timer); }
                el.innerText = Math.floor(count).toLocaleString();
            }, 30);
        }

        const contentConfig = {
            buyer: {
                title: 'Skip the Search for <span class="text-brand-teal">New Homes.</span><br>Make Builders Bid.',
                desc: 'The first marketplace where you define the terms, and top builders compete to build your new construction home.',
                imageSrc: 'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=1200&q=80',
                list: `
                    <li class="flex gap-3"><div class="min-w-5 h-5 mt-0.5"><i data-lucide="check" class="w-5 h-5 text-brand-teal"></i></div><div><strong class="text-brand-teal">Save Time:</strong> Build your "Buy Box" once—define style, budget, and must-haves in minutes.</div></li>
                    <li class="flex gap-3"><div class="min-w-5 h-5 mt-0.5"><i data-lucide="check" class="w-5 h-5 text-brand-teal"></i></div><div><strong class="text-brand-teal">Save Money:</strong> Builders compete for you. Access incentives and off-market pricing.</div></li>
                    <li class="flex gap-3"><div class="min-w-5 h-5 mt-0.5"><i data-lucide="check" class="w-5 h-5 text-brand-teal"></i></div><div><strong class="text-brand-teal">Zero Hassle:</strong> Verify budget privately. No more showing bank statements at open houses.</div></li>`,
                legacyLabel: 'The Struggle',
                legacyHeader: `
                    <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-400 dark:text-gray-300"><i data-lucide="search" class="w-5 h-5"></i></div>
                    Active Shopper`,
                legacyList: `
                     <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400 mt-1"></i> Why does buying feel like a job?</li>
                     <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400 mt-1"></i> Refreshing apps every 15 mins.</li>
                     <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400 mt-1"></i> Begging to spend your money.</li>`,
                conceptTitle: 'The Power Shift',
                conceptDesc: 'We flipped the script. <span class="text-brand-teal font-bold" id="concept-highlight">Become the Client.</span>',
                aeoDef: '<span class="font-bold text-brand-teal">Newer</span> is a new construction marketplace where top builders bid on verified buyers, reversing the traditional search process for new homes.',
                demoTitle: 'Your Personal Market',
                demoDesc: 'Broadcast your needs via the App. Watch the market respond.',
                testimonialTitle: 'New Home Deals & Market Activity',
                testimonialDesc: 'Live transaction feed.',
                journeyTitle: 'The Journey to Your New Construction Home',
                // 1-2-3 Steps Content
                step1Title: 'Define', step1Desc: 'Set your style, budget, and must-haves. Spec, Custom, or QMI.', step1Icon: 'sliders-horizontal',
                step2Title: 'Verify', step2Desc: 'Prove you are real to unlock VIP status.', step2Icon: 'shield-check',
                step3Title: 'Receive', step3Desc: 'Builders compete for your new home business.', step3Icon: 'inbox'
            },
            builder: {
                title: 'Eliminate Spec Risk. Access <span class="text-brand-gold">Verified Buyer Liquidity.</span>',
                desc: 'Stop building on speculation. Access a live order book of pre-verified, off-market buyers ready to sign today. Zero agency fees.',
                imageSrc: 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?auto=format&fit=crop&w=1200&q=80',
                list: `
                    <li class="flex gap-3"><div class="min-w-5 h-5 mt-0.5"><i data-lucide="check" class="w-5 h-5 text-brand-gold"></i></div><div><strong class="text-brand-gold">Zero Marketing Spend:</strong> Direct access to high-intent buyers who have defined their needs.</div></li>
                    <li class="flex gap-3"><div class="min-w-5 h-5 mt-0.5"><i data-lucide="check" class="w-5 h-5 text-brand-gold"></i></div><div><strong class="text-brand-gold">Verified Liquidity:</strong> Plaid-verified leads. Only pitch buyers who can close.</div></li>
                    <li class="flex gap-3"><div class="min-w-5 h-5 mt-0.5"><i data-lucide="check" class="w-5 h-5 text-brand-gold"></i></div><div><strong class="text-brand-gold">Instant Absorption:</strong> Pre-sell lots before you break ground. Reduce carry costs.</div></li>`,
                legacyLabel: 'The Gamble',
                legacyHeader: `
                    <div class="w-10 h-10 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center text-gray-400 dark:text-gray-300"><i data-lucide="dice-5" class="w-5 h-5"></i></div>
                    Spec Builder`,
                legacyList: `
                     <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400 mt-1"></i> Hope is not a business strategy.</li>
                     <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400 mt-1"></i> The Cancellation Trap.</li>
                     <li class="flex gap-3"><i data-lucide="x" class="w-5 h-5 text-red-400 mt-1"></i> Expensive ads for tire-kickers.</li>`,
                conceptTitle: 'Demand Command Center',
                conceptDesc: 'Newer replaces speculation with data. <span class="text-brand-gold font-bold" id="concept-highlight">Don\'t hunt buyers. Choose them.</span>',
                aeoDef: '<span class="font-bold text-brand-gold">Newer</span> provides a live order book of pre-verified homebuyers for custom and production builders, reducing carry costs and speculation.',
                demoTitle: 'Live Order Book',
                demoDesc: 'Filter by lot size, budget, and timeline to find your perfect buyer.',
                testimonialTitle: 'Recent Transactions',
                testimonialDesc: 'Real results.',
                journeyTitle: 'The Path to Pre-Sold Inventory',
                // 1-2-3 Steps Content
                step1Title: 'Filter', step1Desc: 'Set land & budget criteria.', step1Icon: 'filter',
                step2Title: 'Identify', step2Desc: 'Find verified, ready buyers.', step2Icon: 'map',
                step3Title: 'Unlock', step3Desc: 'Directly pitch your build.', step3Icon: 'lock-open'
            }
        };

        const modalConfig = {
            buyer: {
                title: 'Unlock Your Personal Market',
                desc: 'Join 4,200+ buyers receiving off-market bids from builders.',
                btnText: 'Start Receiving Bids',
                micro: 'No credit card required',
                trust: 'Bank-level Encryption (Plaid)',
                color: 'bg-brand-teal',
                hover: 'hover:bg-brand-charcoal'
            },
            builder: {
                title: 'Access High-Intent Demand',
                desc: 'View 1,200+ active buy-boxes in your target zip codes.',
                btnText: 'Search Buyer Demand',
                micro: 'Verification required for approval',
                trust: 'Verified Lead Guarantee',
                color: 'bg-brand-gold',
                hover: 'hover:bg-white hover:text-brand-charcoal'
            }
        };

        const colorMap = {
            buyer: '#0D9488',   // brand-teal
            builder: '#D97706',  // brand-gold
        };

        // Transaction Receipt Data
        const testimonialsData = [
            {
                role: 'buyer',
                time: '2h ago',
                savings: '$14,500',
                builder: 'Lennar (Austin)',
                status: 'OFFER ACCEPTED',
                marketTime: '0 Days'
            },
            {
                role: 'buyer',
                time: '5h ago',
                savings: '$8,200',
                builder: 'PulteGroup',
                status: 'CLOSED',
                marketTime: '0 Days'
            },
            {
                role: 'buyer',
                time: '1d ago',
                savings: '$21,000',
                builder: 'Toll Brothers',
                status: 'CONTRACT SIGNED',
                marketTime: '2 Days'
            },
            {
                role: 'builder',
                time: '45m ago',
                savings: '40% Less DOM',
                builder: 'D. King (Div Pres)',
                status: 'UNIT PRE-SOLD',
                marketTime: '0 Days'
            },
            {
                role: 'builder',
                time: '3h ago',
                savings: '$0 Cancellation',
                builder: 'Custom Builder',
                status: 'LEAD UNLOCKED',
                marketTime: 'Instant'
            },
            {
                role: 'builder',
                time: '1d ago',
                savings: '$12k Carry Saved',
                builder: 'Regional Dev',
                status: 'LOT CONTRACTED',
                marketTime: '4 Days'
            }
        ];
        
        // --- ADDED MISSING DEFINITION ---
        const notifications = [
            { text: "New Match: $450k Budget", icon: "check" },
            { text: "Builder Bid: $15k Incentive", icon: "tag" },
            { text: "Pre-Approval Verified", icon: "shield" }
        ];

        function setAudience(role) {
            currentAudience = role;
            if(role === 'builder') document.documentElement.classList.add('dark');
            else document.documentElement.classList.remove('dark');

            // 1. Text & Image Updates
            const cfg = contentConfig[role] || contentConfig['buyer'];
            
            // Helper for safe text updates
            const setText = (id, text) => { const el = document.getElementById(id); if(el) el.innerHTML = text; };
            
            setText('hero-title', cfg.title);
            setText('hero-desc', cfg.desc);
            setText('concept-title', cfg.conceptTitle);
            setText('concept-desc', cfg.conceptDesc);
            setText('aeo-def-text', cfg.aeoDef);
            setText('concept-label-old', cfg.legacyLabel);
            setText('concept-header-old', cfg.legacyHeader);
            setText('concept-old-list', cfg.legacyList);
            setText('concept-new-list', cfg.list);
            setText('demo-title', cfg.demoTitle);
            setText('demo-desc', cfg.demoDesc);
            setText('testimonial-title', cfg.testimonialTitle);
            setText('testimonial-desc', cfg.testimonialDesc);
            setText('journey-title', cfg.journeyTitle); 

            // Update Steps Logic V1.9 (Icons)
            const step1Title = document.getElementById('step-1-title');
            const step1Desc = document.getElementById('step-1-desc');
            const step2Title = document.getElementById('step-2-title');
            const step2Desc = document.getElementById('step-2-desc');
            const step3Title = document.getElementById('step-3-title');
            const step3Desc = document.getElementById('step-3-desc');

            if(step1Title) step1Title.innerText = cfg.step1Title;
            if(step1Desc) step1Desc.innerText = cfg.step1Desc;
            if(step2Title) step2Title.innerText = cfg.step2Title;
            if(step2Desc) step2Desc.innerText = cfg.step2Desc;
            if(step3Title) step3Title.innerText = cfg.step3Title;
            if(step3Desc) step3Desc.innerText = cfg.step3Desc;

            // Update Icons
            const iconContainerSelector = '.step-icon-container';
            const containers = document.querySelectorAll(iconContainerSelector);
            const stepIcons = [cfg.step1Icon, cfg.step2Icon, cfg.step3Icon];
            
            containers.forEach((el, index) => {
                // Update Color
                el.classList.remove('border-brand-teal', 'border-brand-gold', 'text-brand-teal', 'text-brand-gold');
                el.classList.add(role === 'builder' ? 'border-brand-gold' : 'border-brand-teal');
                el.classList.add(role === 'builder' ? 'text-brand-gold' : 'text-brand-teal');
                
                // Update Icon
                const iconEl = el.querySelector('.step-icon');
                if(iconEl) {
                    iconEl.setAttribute('data-lucide', stepIcons[index]);
                }
            });

            const heroImg = document.getElementById('hero-image-el');
            if(heroImg && heroImg.src !== cfg.imageSrc) {
                heroImg.style.opacity = '0.5';
                const img = new Image(); img.src = cfg.imageSrc;
                img.onload = () => { heroImg.src = cfg.imageSrc; heroImg.style.opacity = '1'; };
            }

            // 2. Animated Toggle Logic
            const pill = document.getElementById('nav-toggle-pill');
            const btnBuyer = document.getElementById('nav-btn-buyer');
            const btnBuilder = document.getElementById('nav-btn-builder');
            
            // New CTA Logic from V2.4
            const ctaBtn = document.getElementById('hero-cta-main');
            const stickyCta = document.getElementById('mobile-sticky-cta');
            const navCta = document.getElementById('nav-cta-btn'); 

            if(role === 'buyer') {
                if(pill) pill.style.transform = 'translateX(0)';
                if(btnBuyer) { btnBuyer.classList.remove('text-gray-500'); btnBuyer.classList.add('text-brand-charcoal'); }
                if(btnBuilder) { btnBuilder.classList.add('text-gray-500'); btnBuilder.classList.remove('text-white'); }
                
                // Set CTA Text for Buyer
                if(ctaBtn) ctaBtn.innerText = 'Start Receiving Bids'; 
                if(stickyCta) stickyCta.innerText = 'Start Receiving Bids'; 
                if(navCta) navCta.innerText = 'Start Receiving Bids'; 

            } else {
                if(pill) pill.style.transform = 'translateX(100%)';
                if(btnBuyer) { btnBuyer.classList.add('text-gray-500'); btnBuyer.classList.remove('text-brand-charcoal'); }
                if(btnBuilder) { btnBuilder.classList.remove('text-gray-500'); btnBuilder.classList.add('text-white'); }
                
                // Set CTA Text for Builder
                if(ctaBtn) ctaBtn.innerText = 'Search Buyer Demand'; 
                if(stickyCta) stickyCta.innerText = 'Search Buyer Demand'; 
                if(navCta) navCta.innerText = 'Search Buyer Demand'; 
            }

            // 3. Mobile Floating Nav
            document.querySelectorAll('.role-btn-mobile').forEach(btn => {
                const isBuilderBtn = btn.innerText.includes('Builder');
                const isActive = (role === 'builder' && isBuilderBtn) || (role === 'buyer' && !isBuilderBtn);
                
                btn.classList.remove('active', 'shadow-sm', 'bg-brand-gold', 'bg-brand-teal', 'bg-white', 'text-brand-charcoal', 'text-white', 'text-gray-500', 'text-gray-400');
                
                if (isActive) {
                    btn.classList.add('active', 'shadow-sm');
                    if (role === 'builder') btn.classList.add('bg-brand-gold', 'text-brand-charcoal');
                    else btn.classList.add('bg-white', 'text-brand-charcoal');
                } else {
                    if (role === 'builder') btn.classList.add('text-gray-400');
                    else btn.classList.add('text-gray-500');
                }
            });

            // 4. Section Visibility & Visuals - USING SAFE HELPERS
            const badgeDot = document.getElementById('hero-badge-dot');
            const ctaBtnEl = document.getElementById('hero-cta-main');
            const conceptBadge = document.getElementById('concept-badge-new');
            const conceptIcon = document.getElementById('concept-icon-new');
            const conceptHighlight = document.getElementById('concept-highlight');
            const stickyCtaEl = document.getElementById('mobile-sticky-cta');

            // Safe removal of classes
            ['bg-brand-teal', 'bg-brand-gold', 'text-brand-teal', 'text-brand-gold'].forEach(c => {
                if(badgeDot) badgeDot.classList.remove(c);
                if(ctaBtnEl) ctaBtnEl.classList.remove(c); 
                if(conceptBadge) conceptBadge.classList.remove(c); 
                if(conceptIcon) conceptIcon.classList.remove(c); 
                if(conceptHighlight) conceptHighlight.classList.remove(c);
            });

            if(role === 'builder') {
                if(badgeDot) badgeDot.classList.add('bg-brand-gold');
                if(ctaBtnEl) {
                    ctaBtnEl.classList.add('bg-brand-gold');
                    ctaBtnEl.classList.add('text-brand-charcoal'); 
                    ctaBtnEl.classList.remove('text-white');
                }
                
                if(conceptBadge) conceptBadge.classList.add('text-brand-gold');
                if(conceptIcon) conceptIcon.classList.add('bg-brand-gold');
                if(conceptHighlight) conceptHighlight.classList.add('text-brand-gold');
                
                toggleClass('pricing-buyer', 'hidden', 'add');
                toggleClass('pricing-builder', 'hidden', 'remove');
                toggleClass('cta-buyer', 'hidden', 'add');
                toggleClass('cta-builder', 'hidden', 'remove'); 

                if(stickyCtaEl) {
                    stickyCtaEl.classList.remove('bg-brand-teal', 'text-white');
                    stickyCtaEl.classList.add('bg-brand-gold', 'text-brand-charcoal');
                }

            } else {
                if(badgeDot) badgeDot.classList.add('bg-brand-teal');
                if(ctaBtnEl) {
                    ctaBtnEl.classList.add('bg-brand-teal');
                    ctaBtnEl.classList.add('text-white'); 
                    ctaBtnEl.classList.remove('text-brand-charcoal');
                }

                if(conceptBadge) conceptBadge.classList.add('text-brand-teal');
                if(conceptIcon) conceptIcon.classList.add('bg-brand-teal');
                if(conceptHighlight) conceptHighlight.classList.add('text-brand-teal');
                
                toggleClass('pricing-buyer', 'hidden', 'remove');
                toggleClass('pricing-builder', 'hidden', 'add');
                toggleClass('cta-buyer', 'hidden', 'remove'); 
                toggleClass('cta-builder', 'hidden', 'add');

                if(stickyCtaEl) {
                    stickyCtaEl.classList.remove('bg-brand-gold', 'text-brand-charcoal');
                    stickyCtaEl.classList.add('bg-brand-teal', 'text-white');
                }
            }
            
            renderTestimonials(role);
            // Re-initialize chat on persona switch
            initChat(role);
            
            const activeHex = colorMap[role];
            ['nav-logo-path-1', 'nav-logo-path-2', 'footer-logo-path-1', 'footer-logo-path-2'].forEach(id => {
                const el = document.getElementById(id);
                if(el) { el.setAttribute('fill', activeHex); el.setAttribute('stroke', activeHex); }
            });

            lucide.createIcons();
            setTimeout(drawMap, 100);
        }

        // ... [Rest of js functions like renderTestimonials, drawMap, etc.]

        function renderTestimonials(role) {
            const tGrid = document.getElementById('testimonials-grid');
            if(!tGrid) return;
            tGrid.innerHTML = '';
            
            const filtered = testimonialsData.filter(t => t.role === role);
            
            filtered.forEach((t, i) => {
                const div = document.createElement('div');
                div.className = "receipt-card bg-white dark:bg-gray-800 p-0 rounded-sm shadow-sm transform transition-all hover:-translate-y-1 relative font-mono text-sm";
                
                const borderColor = role === 'builder' ? 'border-brand-gold' : 'border-brand-teal';
                const textColor = role === 'builder' ? 'text-brand-gold' : 'text-brand-teal';
                const stampColor = role === 'builder' ? '#D97706' : '#0D9488'; 

                div.innerHTML = `
                    <div class="p-6 border-b border-dashed border-gray-300 dark:border-gray-600 relative overflow-hidden">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xs text-gray-400 font-bold uppercase tracking-wider">Transaction Record</span>
                            <span class="${textColor} font-bold">${t.time}</span>
                        </div>
                        <div class="text-2xl font-bold text-brand-charcoal dark:text-white mb-1">${t.savings}</div>
                        <div class="text-xs text-gray-500 uppercase tracking-widest mb-6">Value Unlocked</div>
                        
                        <div class="space-y-2 text-xs">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Market Time:</span>
                                <span class="font-bold text-brand-charcoal dark:text-gray-200">${t.marketTime}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Counterparty:</span>
                                <span class="font-bold text-brand-charcoal dark:text-gray-200">${t.builder}</span>
                            </div>
                        </div>
                        <div class="stamp-container absolute bottom-4 right-4 opacity-0 transform rotate-[-10deg]" style="border-color: ${stampColor}; color: ${stampColor}">
                            ${t.status}
                        </div>
                    </div>
                    <div class="receipt-edge"></div>
                `;
                tGrid.appendChild(div);
            });
            
            // Re-trigger scroll animations for new content
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if(entry.isIntersecting) {
                        const stamps = entry.target.querySelectorAll('.stamp-container');
                        stamps.forEach((s, i) => setTimeout(() => s.classList.add('animate-stamp'), i * 200 + 300));
                        observer.unobserve(entry.target);
                    }
                });
            });
            observer.observe(tGrid);
        }
        
        function selectStyle(s) {
            appState.style = s;
            document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('ring-2', 'ring-brand-teal'));
            event.currentTarget.classList.add('ring-2', 'ring-brand-teal');
            setTimeout(() => nextStep('2'), 300);
        }

        function nextStep(id) {
            document.querySelectorAll('.step-content').forEach(d => d.classList.add('hidden'));
            document.getElementById(`step-${id}`).classList.remove('hidden');
        }

        function updateRange(type, val) {
            if(type === 'bed') { appState.bedrooms = val; document.getElementById('bed-val').innerText = val; }
            if(type === 'budget') { appState.budget = val; document.getElementById('budget-val').innerText = `$${val}k`; }
            updateDashPreview();
        }
        
        function setPersona(p) {
            appState.persona = p;
            document.querySelectorAll('.persona-btn').forEach(b => {
                if(b.innerText.includes(p)) b.classList.add('bg-brand-teal', 'text-white');
                else b.classList.remove('bg-brand-teal', 'text-white');
            });
        }

        function toggleAmenity(btn, name) {
            if(appState.amenities.includes(name)) {
                appState.amenities = appState.amenities.filter(a => a !== name);
                btn.classList.remove('ring-1', 'ring-brand-teal', 'bg-brand-teal/5');
            } else {
                if(appState.amenities.length < 3) {
                    appState.amenities.push(name);
                    btn.classList.add('ring-1', 'ring-brand-teal', 'bg-brand-teal/5');
                }
            }
            updateDashPreview();
        }

        function updateDashPreview() {
            const sEl = document.getElementById('dash-card-style');
            if(sEl) sEl.innerText = appState.style || 'Pending';
            const bEl = document.getElementById('dash-card-budget');
            if(bEl) bEl.innerText = `$${appState.budget}k`;
            const cEl = document.getElementById('dash-card-config');
            if(cEl) cEl.innerText = `${appState.bedrooms}bd`;
            const aEl = document.getElementById('dash-card-amenities');
            if(aEl) aEl.innerText = appState.amenities.join(', ') || 'None';
        }

        function verifyUser(e) {
            e.currentTarget.innerHTML = 'Verifying...';
            setTimeout(() => { 
                nextStep('4'); 
                notifyBuilder(); 
                spawnNotification({text: "Verification Complete", icon: "shield"});
            }, 1000);
        }

        const mockBios = [
            "Professional Couple seeking a modern sanctuary. Pre-approved and ready to move quickly for the right home office setup.",
            "Growing family prioritizing school district and space. Looking for a functional layout with room to expand.",
            "Design-conscious buyer seeking architectural uniqueness. Flexible closing timeline for the perfect modern aesthetic."
        ];
        
        function generateBuyerBio() {
            const btn = document.getElementById('btn-generate-bio');
            const container = document.getElementById('ai-bio-container');
            const text = document.getElementById('ai-bio-text');
            
            btn.innerHTML = '<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Generating...'; btn.disabled = true;
            lucide.createIcons();
            
            setTimeout(() => {
                const randomBio = mockBios[Math.floor(Math.random() * mockBios.length)];
                container.classList.remove('hidden');
                text.innerText = `"${randomBio}"`;
                btn.innerHTML = '<span>✨</span> Regenerate Bio'; btn.disabled = false;
            }, 1200);
        }

        function getOrigin(elementId) {
            const el = document.getElementById(elementId);
            if (!el) return { x: 0.5, y: 0.5 }; 
            const rect = el.getBoundingClientRect();
            const x = (rect.left + rect.width / 2) / window.innerWidth;
            const y = (rect.top + rect.height / 2) / window.innerHeight;
            return { x, y };
        }

        function notifyBuilder() {
            const overlay = document.getElementById('user-card-overlay');
            if(overlay) overlay.classList.remove('translate-y-full');
            const origin = getOrigin('builder-dashboard-container');
            // POP 1: Builder receives verified lead
            confetti({ particleCount: 30, spread: 60, origin: origin, colors: ['#0D9488', '#D97706'] }); 
        }

        function unlockLead() {
            if(appState.credits < 50) return;
            appState.credits -= 50;
            const credStat = document.getElementById('stat-credits');
            if(credStat) credStat.innerText = appState.credits;
            document.getElementById('pitch-modal').classList.remove('hidden');
        }

        function selectPitch(el) {
            el.classList.add('border-brand-gold', 'bg-gray-600');
        }
        
        const mockPitches = [
            "We have a lot in Phase 2 perfectly suited for your custom plan. Let's discuss a build-to-suit option.",
            "I have a spec home finishing in 45 days that hits all your requirements. $10k incentive if under contract this month.",
            "Your budget aligns with our new 'Modern Series'. Verify your funds and let's schedule a hard hat tour."
        ];

        function generateBuilderPitch() {
            const btn = document.getElementById('btn-ai-pitch');
            const area = document.getElementById('pitch-message');
            btn.innerText = 'Thinking...';
            setTimeout(() => {
                area.value = mockPitches[Math.floor(Math.random() * mockPitches.length)];
                btn.innerHTML = '<span>✨</span> AI Draft';
            }, 800);
        }

        function sendPitch() {
             document.getElementById('pitch-modal').classList.add('hidden');
             document.getElementById('user-card-overlay').classList.add('translate-y-full');
             
             const container = document.getElementById('buyer-pitches-container');
             container.innerHTML = `
                 <div class="animate-fade-in p-4 bg-brand-teal/5 border border-brand-teal rounded-xl cursor-pointer hover:shadow-md transition-all" onclick="acceptPitch()">
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-[10px] font-bold uppercase text-brand-teal">New Proposal</div>
                        <div class="w-6 h-6 rounded-full bg-brand-teal text-white flex items-center justify-center"><i data-lucide="home" class="w-3 h-3"></i></div>
                    </div>
                    <h4 class="font-bold text-sm text-brand-charcoal mb-1">Move-In Ready Match</h4>
                    <p class="text-xs text-gray-500 mb-3">"We have a spec home finishing in 45 days that hits all your requirements..."</p>
                    <button class="w-full py-2 bg-brand-teal text-white text-xs font-bold rounded-lg">View Details</button>
                 </div>
             `;
             lucide.createIcons();
             spawnNotification({text: "Pitch Sent!", icon: "send"});
        }

        function acceptPitch() {
             const container = document.getElementById('buyer-screen-container');
             container.innerHTML = `
                <div class="h-full flex flex-col items-center justify-center text-center p-6 animate-fade-in">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-4 shadow-sm border border-green-200">
                        <i data-lucide="check" class="w-10 h-10"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-brand-charcoal mb-2">It's a Match!</h3>
                    <p class="text-sm text-gray-500 mb-6">Builder notified. Preparing contract.</p>
                    <button onclick="resetDemo()" class="text-xs text-brand-teal underline">Start Over</button>
                </div>
             `;
             lucide.createIcons();
             
             const phoneOrigin = getOrigin('phone-container');
             confetti({ particleCount: 100, spread: 70, origin: phoneOrigin, colors: ['#0D9488', '#10B981'] }); 
             
             triggerBuilderSale();
        }

        function triggerBuilderSale() {
            const body = document.getElementById('builder-dashboard-body');
            
            const wrapper = document.createElement('div');
            wrapper.id = 'builder-sale-overlay-wrapper';
            wrapper.className = 'absolute inset-0 z-50 flex items-center justify-center pointer-events-none';
            
            const saleAlert = document.createElement('div');
            saleAlert.className = 'w-4/5 bg-gray-900/95 border-2 border-brand-gold rounded-xl shadow-2xl p-6 text-center animate-fade-in backdrop-blur-xl pointer-events-auto';
            saleAlert.innerHTML = `
                <div class="mb-4 stamp-container animate-stamp" style="border-color: #D97706; color: #D97706">SOLD</div>
                <h3 class="text-xl font-bold text-white mb-1 uppercase tracking-wider">Sale Pending</h3>
                <p class="text-xs text-gray-400 mb-4">Buyer #8942 Accepted</p>
                <div class="text-[10px] text-gray-500 italic">Marketing Spend: $0.00</div>
            `;
            
            wrapper.appendChild(saleAlert);
            body.appendChild(wrapper);
        }

        function resetDemo() {
            const list = document.getElementById('dashboard-list-view');
            if(list) list.innerHTML = '';
            
            const saleWrapper = document.getElementById('builder-sale-overlay-wrapper');
            if (saleWrapper) saleWrapper.remove();
            
            location.reload(); 
        }

        function updateROI(homes) {
            const savingsPerHome = 14350; 
            const total = homes * savingsPerHome;
            document.getElementById('roi-homes').innerText = `${homes} Homes`;
            document.getElementById('roi-savings').innerText = `$${total.toLocaleString()}`;
        }

        function addFeedItem() {
            const container = document.getElementById('dashboard-list-view');
            if (!container) return;
            const item = document.createElement('div');
            item.className = "flex items-center justify-between p-3 bg-gray-800 rounded-xl border border-gray-700 animate-pulse";
            item.innerHTML = `<div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-mono text-gray-400">#${Math.floor(Math.random()*9000)+1000}</div><div><div class="text-xs font-bold text-white">Active Search</div><div class="text-[10px] text-gray-500">Just Now</div></div></div><div class="text-xs font-mono font-bold text-brand-gold">$${Math.floor(Math.random()*400)+400}k</div>`;
            container.prepend(item);
            if(container.children.length > 8) container.lastElementChild.remove();
        }

        function toggleDashboardView(v) {
            const list = document.getElementById('dashboard-list-view');
            const map = document.getElementById('dashboard-map-view');
            const intel = document.getElementById('dashboard-intel-view');
            const listBtn = document.getElementById('view-list-btn');
            const mapBtn = document.getElementById('view-map-btn');
            const intelBtn = document.getElementById('view-intel-btn');

            if(list) list.classList.add('hidden'); 
            if(map) map.classList.add('hidden'); 
            if(intel) intel.classList.add('hidden');
            
            [listBtn, mapBtn, intelBtn].forEach(b => { 
                if(b) {
                    b.classList.remove('bg-brand-gold', 'text-brand-charcoal'); 
                    b.classList.add('text-gray-400'); 
                }
            });

            if(v === 'map') { 
                map.classList.remove('hidden'); mapBtn.classList.add('bg-brand-gold', 'text-brand-charcoal'); drawMap(); 
            } else if (v === 'intel') {
                intel.classList.remove('hidden'); intelBtn.classList.add('bg-brand-gold', 'text-brand-charcoal'); initChart();
            } else { 
                list.classList.remove('hidden'); listBtn.classList.add('bg-brand-gold', 'text-brand-charcoal'); 
            }
        }

        function drawMap() {
            const c = document.getElementById('demandMap');
            if(!c) return;
            c.width = c.parentElement.offsetWidth;
            c.height = c.parentElement.offsetHeight;
            const ctx = c.getContext('2d');
            
            ctx.fillStyle = '#111827';
            ctx.fillRect(0,0,c.width,c.height);
            
            heatMapPoints.forEach(p => {
                const x = p.x * c.width;
                const y = p.y * c.height;
                const grad = ctx.createRadialGradient(x, y, 0, x, y, p.r);
                grad.addColorStop(0, 'rgba(217, 119, 6, 0.2)'); 
                grad.addColorStop(1, 'rgba(217, 119, 6, 0)'); 
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(x, y, p.r, 0, Math.PI*2);
                ctx.fill();
            });
        }

        function initChart() {
            if(intelChartInstance) return;
            const c = document.getElementById('intelChart');
            if(!c) return;
            const ctx = c.getContext('2d');
            intelChartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'], datasets: [{ label: 'Avg Buyer Budget', data: [420, 435, 430, 450, 465, 485], borderColor: '#D97706', tension: 0.4, borderWidth: 2, pointRadius: 0 }] }, 
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { ticks: { color: '#6b7280' }, grid: { display: false } } } }
            });
        }
        
        function openWaitlistModal(role) { 
            const target = role || currentAudience;
            updateModalContext(target);
            document.getElementById('waitlist-modal').classList.remove('hidden'); 
        }
        
        function updateModalContext(role) {
            const conf = modalConfig[role];
            document.getElementById('waitlist-title').innerText = conf.title;
            document.getElementById('waitlist-desc').innerText = conf.desc;
            const btn = document.getElementById('waitlist-submit-btn');
            btn.innerText = conf.btnText;
            btn.className = `w-full py-3 font-bold rounded-xl hover:shadow-lg hover:-translate-y-0.5 transition-all duration-300 ${conf.color} ${conf.hover}`;
            if(role === 'builder') { btn.classList.remove('text-white'); btn.classList.add('text-brand-charcoal'); }
            else { btn.classList.add('text-white'); btn.classList.remove('text-brand-charcoal'); }
            
            const badge = document.getElementById('waitlist-badge-bg');
            badge.classList.remove('bg-brand-teal', 'bg-brand-gold');
            badge.classList.add(role === 'builder' ? 'bg-brand-gold' : 'bg-brand-teal');
            
            document.getElementById('waitlist-trust-text').innerText = conf.trust;
            
            const buyerInput = document.getElementById('role-buyer-input');
            const builderInput = document.getElementById('role-builder-input');
            if(role === 'buyer') buyerInput.checked = true;
            else builderInput.checked = true;
        }

        function closeWaitlistModal() { document.getElementById('waitlist-modal').classList.add('hidden'); }

        // --- ADDED MISSING FUNCTION ---
        function spawnNotification(custom) {
            const container = document.getElementById('hero-floating-notifications');
            if(!container) return;
            const notif = custom || notifications[Math.floor(Math.random() * notifications.length)];
            const el = document.createElement('div');
            el.className = "floating-bubble bg-white/90 dark:bg-gray-900/90 backdrop-blur px-4 py-2 rounded-xl shadow-lg border border-white/20 text-xs font-bold flex items-center gap-2 text-brand-charcoal dark:text-white";
            
            // Check if custom is object or text (handles both string and object input)
            const iconName = notif.icon || 'check';
            const textContent = notif.text || (typeof custom === 'string' ? custom : 'Notification');
            
            el.innerHTML = `<i data-lucide="${iconName}" class="w-3 h-3 text-brand-teal"></i> ${textContent}`;
            container.appendChild(el);
            lucide.createIcons();
            setTimeout(() => { el.remove(); }, 4000);
        }

        document.addEventListener('DOMContentLoaded', () => { 
            lucide.createIcons(); 
            setAudience('buyer'); 
            setInterval(addFeedItem, 3000); 
            setInterval(spawnNotification, 2500); 
            addFeedItem(); 
        });

    </script>
</body>
</html>
